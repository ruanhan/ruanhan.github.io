<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#1.0.0'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>mysql - Hexo</title>
  
    <meta name="keywords" content="sql">
  
  
    <meta name="description" content="mysql">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h'>
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
          
          
            BELIEF <b><sup style='color:#3AA757'>1.0.0</sup></b>
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box reveal shadow article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h1 class="title">
    <a href="/2021/05/10/mysql/">
      mysql
    </a>
  </h1>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="https://xaoxuu.com" target="_blank" rel="nofollow noopener">
    <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png">
    <p>Mr. X</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/mysql/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>mysql</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：May 10, 2021</p>
  </a>
</div>

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <h2 id="1-数据库能够做什么"><a href="#1-数据库能够做什么" class="headerlink" title="1. 数据库能够做什么"></a>1. 数据库能够做什么</h2><ul>
<li>存储大量数据，方便检索和访问</li>
<li>保持数据信息的一致、完整</li>
<li>共享和安全</li>
<li>通过组合分析，产生新的有用信息</li>
</ul>
<h2 id="2-数据库的基本概念"><a href="#2-数据库的基本概念" class="headerlink" title="2. 数据库的基本概念"></a>2. 数据库的基本概念</h2><h3 id="2-1-实体"><a href="#2-1-实体" class="headerlink" title="2.1 实体"></a>2.1 实体</h3><p>只要是在客观世界存在的、可以被描述出来的都是实体</p>
<h3 id="2-2-数据库-DB"><a href="#2-2-数据库-DB" class="headerlink" title="2.2 数据库(DB)"></a>2.2 数据库(DB)</h3><ul>
<li>数据库就是数据的仓库，可以存放结构化的数据</li>
</ul>
<h3 id="2-3-数据库管理系统-DBMS"><a href="#2-3-数据库管理系统-DBMS" class="headerlink" title="2.3 数据库管理系统(DBMS)"></a>2.3 数据库管理系统(DBMS)</h3><p>是一种系统软件，提供操作数据库的环境，可以通过数据库管理系统对数据进行插入、修改、删除和查询等操作。</p>
<h3 id="2-4-SQL"><a href="#2-4-SQL" class="headerlink" title="2.4 SQL"></a>2.4 SQL</h3><p>结构化查询语言 专门用来和数据库进行交流的语言,几乎所有的DBMS都支持SQL</p>
<p><img src="1.png" alt="dbms"></p>
<h3 id="2-5-SQL规范"><a href="#2-5-SQL规范" class="headerlink" title="2.5 SQL规范"></a>2.5 SQL规范</h3><ol>
<li>SQL语句不区分大小写，建议SQL关键字大写，表名和列表小写</li>
<li>命令用分号结尾</li>
<li>命令可以缩进和换行，一种类型的关键字放在一行</li>
<li>可以写单行和多行注释 , #和–是单行注释，/***/多行注释</li>
</ol>
<h2 id="3-数据表"><a href="#3-数据表" class="headerlink" title="3. 数据表"></a>3. 数据表</h2><ul>
<li>表是数据库中包含所有数据的数据库对象，也是其它对象的基础。</li>
<li>表定义是一个列的集合，数据在表中是按行和列的格式组织的，用来存放数据</li>
<li>行也称为记录用来存放一个个实体，列称为字段用来描述实体的某一个属性 学生管理系统2</li>
</ul>
<h2 id="4-MYSQL简介"><a href="#4-MYSQL简介" class="headerlink" title="4.MYSQL简介"></a>4.MYSQL简介</h2><h3 id="4-1-MYSQL特点"><a href="#4-1-MYSQL特点" class="headerlink" title="4.1 MYSQL特点"></a>4.1 MYSQL特点</h3><ul>
<li>开源免费</li>
<li>性能高</li>
<li>安装使用都简单</li>
</ul>
<h3 id="4-2-MYSQL安装"><a href="#4-2-MYSQL安装" class="headerlink" title="4.2 MYSQL安装"></a>4.2 MYSQL安装</h3><ul>
<li><a href="https://dev.mysql.com/downloads/mysql/5.5.html" target="_blank" rel="noopener">mysql下载</a></li>
<li>安装MYSQL</li>
</ul>
<h3 id="4-3-MYSQL配置"><a href="#4-3-MYSQL配置" class="headerlink" title="4.3 MYSQL配置"></a>4.3 MYSQL配置</h3><p>C:\Program Files\MySQL\MySQL Server 5.5\my.ini</p>
<ul>
<li>port 端口号</li>
<li>basedir 安装目录</li>
<li>datadir 数据存放访目录</li>
<li>character_set_server 字符集</li>
<li>default-storage-engine 存储引擎</li>
<li>sql-mode 语法模式</li>
<li>max-connections 最大连接数</li>
</ul>
<h3 id="4-4-MYSQL启动和停止"><a href="#4-4-MYSQL启动和停止" class="headerlink" title="4.4 MYSQL启动和停止"></a>4.4 MYSQL启动和停止</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net start MySQL</span><br><span class="line">net stop MySQL</span><br></pre></td></tr></table></figure>

<h3 id="4-5-通过命令行连接MYSQL"><a href="#4-5-通过命令行连接MYSQL" class="headerlink" title="4.5 通过命令行连接MYSQL"></a>4.5 通过命令行连接MYSQL</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -P <span class="number">3306</span> -uroot -p123456</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<h3 id="4-6-切换数据库"><a href="#4-6-切换数据库" class="headerlink" title="4.6 切换数据库"></a>4.6 切换数据库</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use test;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-显示有哪些表"><a href="#4-7-显示有哪些表" class="headerlink" title="4.7 显示有哪些表"></a>4.7 显示有哪些表</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br><span class="line">show tables <span class="keyword">from</span> mysql;</span><br></pre></td></tr></table></figure>

<h3 id="4-8-显示当前数据库"><a href="#4-8-显示当前数据库" class="headerlink" title="4.8 显示当前数据库"></a>4.8 显示当前数据库</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select database();</span><br></pre></td></tr></table></figure>

<h3 id="4-9-查询表结构"><a href="#4-9-查询表结构" class="headerlink" title="4.9 查询表结构"></a>4.9 查询表结构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC user;</span><br></pre></td></tr></table></figure>

<h2 id="5-创建表"><a href="#5-创建表" class="headerlink" title="5. 创建表"></a>5. 创建表</h2><p><img src="2.png" alt="student"> <img src="3.png" alt="course"> <img src="4.png" alt="score"></p>
<h2 id="6-数据完整性"><a href="#6-数据完整性" class="headerlink" title="6. 数据完整性"></a>6. 数据完整性</h2><ul>
<li>为了实现数据完整性，需要检验数据库表中的每行和每列数据是否符合要求</li>
<li>在创建表的时候，应该保证以后的数据输入是正确的，错误的数据不允许输入</li>
</ul>
<h3 id="6-1-域完整性"><a href="#6-1-域完整性" class="headerlink" title="6.1 域完整性"></a>6.1 域完整性</h3><p>不同的字段需要设置为各种合适的类型，比如年龄就是整数类型</p>
<p><img src="5.jpeg" alt="datatype"></p>
<p><img src="6.jpeg" alt="mysqlint"></p>
<p><img src="7.jpeg" alt="mysqlnumber"></p>
<h3 id="6-2-默认值"><a href="#6-2-默认值" class="headerlink" title="6.2 默认值"></a>6.2 默认值</h3><p>默认值是指如果用户没有指定值的情况下会记录的此字段指定一个提供一个预先设定的值</p>
<blockquote>
<p>可以把居住地默认值设置为北京</p>
</blockquote>
<h3 id="6-3-非空约束"><a href="#6-3-非空约束" class="headerlink" title="6.3 非空约束"></a>6.3 非空约束</h3><p>我们可以指定某个字段不能不输入，必须提供一个非空的值</p>
<blockquote>
<p>姓名字段不能为空</p>
</blockquote>
<h2 id="7-实体完整性"><a href="#7-实体完整性" class="headerlink" title="7.实体完整性"></a>7.实体完整性</h2><h3 id="7-1-主键约束"><a href="#7-1-主键约束" class="headerlink" title="7.1 主键约束"></a>7.1 主键约束</h3><ul>
<li>表中一列或者几列组合的值能用来唯一标识表中的每一行，这样的列或者列组合称为表的主键，主键表的数据不同重复。</li>
<li>如果两列或者多列组合起来唯一标识表中的每一行，则该主键又称为”组合键”</li>
</ul>
<p><strong>主键的选择标准</strong></p>
<ol>
<li>最少性 尽量选择单个键作为主键</li>
<li>稳定性 ，由于主键是用来在两个表间建立联接的，所以不能经常更新，最好就不更新</li>
</ol>
<h3 id="7-2-外键"><a href="#7-2-外键" class="headerlink" title="7.2 外键"></a>7.2 外键</h3><p>成绩表中的学生ID应该在学生表中是存在的 我们应该让成绩表中的ID只能引用学生表中的ID，它们的值应该是一一对应的，也就是说成绩表中的ID是成绩表中的外键，对应学生表的主键 ，这样就可以保证数据的引用完整性</p>
<h3 id="7-3-唯一约束"><a href="#7-3-唯一约束" class="headerlink" title="7.3 唯一约束"></a>7.3 唯一约束</h3><p>唯一约束是指某个字段值是唯一的，在所有的记录中不能有重复的值.</p>
<blockquote>
<p>学生的身份证号可以设置为唯一约束</p>
</blockquote>
<h3 id="7-4-标识列"><a href="#7-4-标识列" class="headerlink" title="7.4 标识列"></a>7.4 标识列</h3><ul>
<li>当表中没有合适的列作为主键时可以考虑增加标识列，标识列是一个无实际业务含义的列，仅仅用来区分每条记录。</li>
<li>标识列的值是自动生成的，不能在该列上输入数据</li>
</ul>
<h3 id="7-5-外键约束"><a href="#7-5-外键约束" class="headerlink" title="7.5 外键约束"></a>7.5 外键约束</h3><p>一个表的外键必须引用另一个表的主键,比如成绩表中的学生ID会引用学生表的主键，课程ID会引用成绩表的主键</p>
<ul>
<li>主表没有记录，子表中不能添加相应的记录</li>
<li>修改和删除主表记录不能让子表记录孤立，必须相应修改和删除</li>
</ul>
<h2 id="8-数据操作"><a href="#8-数据操作" class="headerlink" title="8. 数据操作"></a>8. 数据操作</h2><h3 id="8-1-创建学生表"><a href="#8-1-创建学生表" class="headerlink" title="8.1 创建学生表"></a>8.1 创建学生表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> (</span><br><span class="line"><span class="string">`id`</span>  <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT   ,</span><br><span class="line"><span class="string">`name`</span>  <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line"><span class="string">`age`</span>  <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> ,</span><br><span class="line"><span class="string">`city`</span>  <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="string">'北京'</span> ,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="8-2-增加身份证号字段"><a href="#8-2-增加身份证号字段" class="headerlink" title="8.2 增加身份证号字段"></a>8.2 增加身份证号字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="string">`idcard`</span>  <span class="built_in">varchar</span>(<span class="number">15</span>) <span class="literal">NULL</span> <span class="keyword">AFTER</span> <span class="string">`city`</span>; <span class="comment">--增加身份证字段</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> <span class="string">`idcard`</span>  <span class="built_in">varchar</span>(<span class="number">18</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">AFTER</span> <span class="string">`name`</span>; <span class="comment">--修改身份证字段</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`student`</span><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> <span class="string">`idcard`</span>; <span class="comment">--删除身份证字段</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-添加约束"><a href="#8-3-添加约束" class="headerlink" title="8.3 添加约束"></a>8.3 添加约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 主键约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>);</span><br><span class="line"><span class="comment">-- 唯一约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> <span class="string">`uq_idcard`</span> (<span class="string">`idcard`</span>) ;</span><br><span class="line"><span class="comment">-- 默认约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> <span class="string">`city`</span>  <span class="built_in">varchar</span>(<span class="number">50</span>)  <span class="keyword">DEFAULT</span> <span class="string">'北京'</span> <span class="keyword">AFTER</span> <span class="string">`age`</span>;</span><br><span class="line"><span class="comment">-- 外键约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`score`</span> <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="string">`fk_stuid`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`student_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`student`</span> (<span class="string">`id`</span>);</span><br><span class="line"><span class="comment">-- 删除约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`score`</span> <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="string">`fk_stuid`</span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-4-准备数据"><a href="#8-4-准备数据" class="headerlink" title="8.4 准备数据"></a>8.4 准备数据</h3><p><img src="8.png" alt="relations"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`student`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`idcard`</span> <span class="built_in">varchar</span>(<span class="number">18</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`age`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`city`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`course`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`score`</span> (</span><br><span class="line">  <span class="string">`student_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`course_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`grade`</span> <span class="built_in">float</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`student_id`</span>,<span class="string">`course_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_courseid`</span> (<span class="string">`course_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_courseid`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`course_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`course`</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_stuid`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`student_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`student`</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<h2 id="9-SQL"><a href="#9-SQL" class="headerlink" title="9. SQL"></a>9. SQL</h2><h3 id="9-1-SQL是什么"><a href="#9-1-SQL是什么" class="headerlink" title="9.1 SQL是什么"></a>9.1 SQL是什么</h3><p>Structured Query Language：结构化查询语言</p>
<h3 id="9-2-为什么要用SQL"><a href="#9-2-为什么要用SQL" class="headerlink" title="9.2 为什么要用SQL"></a>9.2 为什么要用SQL</h3><ol>
<li>使用界面操作数据库不方便</li>
<li>我们需要通过应用程序去操作数据库</li>
</ol>
<h3 id="9-3-SQL组成"><a href="#9-3-SQL组成" class="headerlink" title="9.3 SQL组成"></a>9.3 SQL组成</h3><h4 id="9-3-1-DDL（data-definition-language）是数据定义语言"><a href="#9-3-1-DDL（data-definition-language）是数据定义语言" class="headerlink" title="9.3.1 DDL（data definition language）是数据定义语言"></a>9.3.1 DDL（data definition language）是数据定义语言</h4><p>主要的命令有<code>CREATE</code>、<code>ALTER</code>、<code>DROP</code>等，<strong>DDL</strong>主要是用在定义或改变表（TABLE）的结构，数据类型，表之间的链接和约束等初始化工作上，他们大多在建立表时使用</p>
<h4 id="9-3-2-DML（data-manipulation-language）是数据操纵语言"><a href="#9-3-2-DML（data-manipulation-language）是数据操纵语言" class="headerlink" title="9.3.2 DML（data manipulation language）是数据操纵语言"></a>9.3.2 DML（data manipulation language）是数据操纵语言</h4><p>它们是<code>SELECT</code>、<code>UPDATE、</code>INSERT<code>、</code>DELETE`，就象它的名字一样，这4条命令是用来对数据库里的数据进行操作的语言</p>
<h4 id="9-3-3-DCL（DataControlLanguage）是数据库控制语言"><a href="#9-3-3-DCL（DataControlLanguage）是数据库控制语言" class="headerlink" title="9.3.3 DCL（DataControlLanguage）是数据库控制语言"></a>9.3.3 DCL（DataControlLanguage）是数据库控制语言</h4><p>是用来设置或更改数据库用户或角色权限的语句，包括（<code>grant</code>,<code>revoke</code>等）语句</p>
<h3 id="9-4-SQL运算符"><a href="#9-4-SQL运算符" class="headerlink" title="9.4 SQL运算符"></a>9.4 SQL运算符</h3><p>是一种符号，它是用来进行列间或者变量之间的比较和数学运算的</p>
<h3 id="9-4-1-算术运算符"><a href="#9-4-1-算术运算符" class="headerlink" title="9.4.1 算术运算符"></a>9.4.1 算术运算符</h3><table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">加运算，求两个数或表达式相加的和，如1+1</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">减少减运算，求两个数或表达式相减的差，如4-1</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">乘运算，求两个数或表达式相乘的积，如2*2</td>
</tr>
<tr>
<td align="left">/</td>
<td align="left">除运算，求两个数或表达式相除的商，如6/4的值为1</td>
</tr>
<tr>
<td align="left">%</td>
<td align="left">取模运算，求两个数或表达式相除的余数，如：6%4的值为2</td>
</tr>
</tbody></table>
<ul>
<li>查询姓名全称</li>
</ul>
<h3 id="9-4-2-逻辑运算符"><a href="#9-4-2-逻辑运算符" class="headerlink" title="9.4.2 逻辑运算符"></a>9.4.2 逻辑运算符</h3><table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">AND</td>
<td align="left">当且仅当两个布尔表达式都为true时，返回TRUE</td>
</tr>
<tr>
<td align="left">OR</td>
<td align="left">当且仅当两个布尔表达式都为false，返回FALSE</td>
</tr>
<tr>
<td align="left">NOT</td>
<td align="left">布尔表达式的值取反</td>
</tr>
</tbody></table>
<h3 id="9-4-3-比较运算符"><a href="#9-4-3-比较运算符" class="headerlink" title="9.4.3 比较运算符"></a>9.4.3 比较运算符</h3><table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">=</td>
<td align="left">等于</td>
</tr>
<tr>
<td align="left">&gt;</td>
<td align="left">大于</td>
</tr>
<tr>
<td align="left">&lt;</td>
<td align="left">小于</td>
</tr>
<tr>
<td align="left">&lt;&gt;</td>
<td align="left">不等于</td>
</tr>
<tr>
<td align="left">&gt;=</td>
<td align="left">大于等于</td>
</tr>
<tr>
<td align="left">&lt;=</td>
<td align="left">小于等于</td>
</tr>
<tr>
<td align="left">!=</td>
<td align="left">不等于</td>
</tr>
</tbody></table>
<h2 id="9-5-查询窗口"><a href="#9-5-查询窗口" class="headerlink" title="9.5 查询窗口"></a>9.5 查询窗口</h2><p><img src="9.png" alt="query"></p>
<h2 id="9-6-数据操作语言"><a href="#9-6-数据操作语言" class="headerlink" title="9.6 数据操作语言"></a>9.6 数据操作语言</h2><h3 id="9-6-1-插入数据行"><a href="#9-6-1-插入数据行" class="headerlink" title="9.6.1 插入数据行"></a>9.6.1 插入数据行</h3><h4 id="9-6-1-1-语法"><a href="#9-6-1-1-语法" class="headerlink" title="9.6.1.1 语法"></a>9.6.1.1 语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span>  [<span class="keyword">INTO</span>]  表名  [(列名)] <span class="keyword">VALUES</span>  (值列表)</span><br></pre></td></tr></table></figure>

<h4 id="9-6-1-2-插入记录"><a href="#9-6-1-2-插入记录" class="headerlink" title="9.6.1.2 插入记录"></a>9.6.1.2 插入记录</h4><p>向学生表插入一条记录, 姓名张三,身份证号123456,年龄30,城市北京</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> [school].[student]</span><br><span class="line">(<span class="keyword">name</span>,idcard,age,city)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">'张三'</span>,<span class="string">'123456'</span>,<span class="number">30</span>,<span class="string">'北京'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="9-6-1-3-注意事项"><a href="#9-6-1-3-注意事项" class="headerlink" title="9.6.1.3 注意事项"></a>9.6.1.3 注意事项</h4><ul>
<li>每次插入一行数据，不能只插入一部分数据，插入的数据是否有效将按照整行的完整性要求来检验</li>
<li>每个数据值的数据类型、精度、位数必须与要应的列名精确匹配</li>
<li>不能为标识符指定值</li>
<li>如果某字段设置为不能为空，则必须插入数据</li>
<li>插入数据时还要符合检查性约束的要求</li>
<li>有缺省值的列，可以使用DEFAULT关键字来代替插入实际的值</li>
</ul>
<h3 id="9-6-2-更新数据行"><a href="#9-6-2-更新数据行" class="headerlink" title="9.6.2 更新数据行"></a>9.6.2 更新数据行</h3><h4 id="9-6-2-1-语法"><a href="#9-6-2-1-语法" class="headerlink" title="9.6.2.1 语法"></a>9.6.2.1 语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">SET</span> 列名 = 更新值 [<span class="keyword">WHERE</span> 更新条件]</span><br></pre></td></tr></table></figure>

<h4 id="9-6-2-2-更新记录"><a href="#9-6-2-2-更新记录" class="headerlink" title="9.6.2.2 更新记录"></a>9.6.2.2 更新记录</h4><ul>
<li><p>更新ID等于7的学生年龄改为40，城市改为上海</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> [school].[student]</span><br><span class="line"> <span class="keyword">SET</span> age = <span class="number">40</span>,city = <span class="string">'上海'</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">7</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="9-6-2-3-注意"><a href="#9-6-2-3-注意" class="headerlink" title="9.6.2.3 注意"></a>9.6.2.3 注意</h4><ul>
<li>多列时用逗号隔开，一定要加更新条件以免错误更新</li>
<li>多个联合条件使用 AND <code>id=7 and idcard=&#39;410787&#39;</code></li>
<li>判断某字段是否为空 <code>email is null or email = &#39;&#39;</code></li>
</ul>
<h3 id="9-6-3-删除数据"><a href="#9-6-3-删除数据" class="headerlink" title="9.6.3 删除数据"></a>9.6.3 删除数据</h3><h4 id="9-6-3-1-语法"><a href="#9-6-3-1-语法" class="headerlink" title="9.6.3.1 语法"></a>9.6.3.1 语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> [<span class="keyword">FROM</span>]  表名 [<span class="keyword">WHERE</span> &lt;删除条件&gt;]</span><br></pre></td></tr></table></figure>

<h4 id="9-6-3-2-删除记录"><a href="#9-6-3-2-删除记录" class="headerlink" title="9.6.3.2 删除记录"></a>9.6.3.2 删除记录</h4><ul>
<li><p>删除ID=7的学生记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> [school].[student] <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">7</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="9-6-3-3-注意"><a href="#9-6-3-3-注意" class="headerlink" title="9.6.3.3 注意"></a>9.6.3.3 注意</h4><ul>
<li>Delete语句是对整行进行操作，因此不需要提供列名</li>
<li>如果要删除主表数据，则要先删除子表记录</li>
</ul>
<h3 id="9-6-4-TRUNCATE-截断表"><a href="#9-6-4-TRUNCATE-截断表" class="headerlink" title="9.6.4 TRUNCATE 截断表"></a>9.6.4 TRUNCATE 截断表</h3><p>截断整个表中的数据</p>
<h4 id="9-6-4-1-语法"><a href="#9-6-4-1-语法" class="headerlink" title="9.6.4.1 语法"></a>9.6.4.1 语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span>  <span class="keyword">TABLE</span>  表名</span><br></pre></td></tr></table></figure>

<h4 id="9-6-4-2-截断学生表"><a href="#9-6-4-2-截断学生表" class="headerlink" title="9.6.4.2 截断学生表"></a>9.6.4.2 截断学生表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> student</span><br></pre></td></tr></table></figure>

<blockquote>
<p>数据全部清空,但表结构、列、约束等不被改动 不能用于有外键约束引用的表 标识列重新开始编号 因为要删除的数据不会写入日志，数据也不能恢复，所以工作中请尽量不要使用此命令</p>
</blockquote>
<h2 id="9-7-数据查询"><a href="#9-7-数据查询" class="headerlink" title="9.7 数据查询"></a>9.7 数据查询</h2><ul>
<li>查询就是从客户端 发出查询请求数据库服务器，并从数据库返回查询结果的过程</li>
<li>每次执行查询只是从数据表中提取数据，并按表的方式呈现出来</li>
<li>查询产生的是虚拟表,并不会保存起来</li>
</ul>
<h3 id="9-7-1-查询"><a href="#9-7-1-查询" class="headerlink" title="9.7.1 查询"></a>9.7.1 查询</h3><h4 id="9-7-1-1-语法"><a href="#9-7-1-1-语法" class="headerlink" title="9.7.1.1 语法"></a>9.7.1.1 语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>    &lt;列名&gt; </span><br><span class="line"><span class="keyword">FROM</span>      &lt;表名&gt; </span><br><span class="line">[<span class="keyword">WHERE</span>    &lt;查询条件表达式&gt;] </span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> &lt;排序的列名&gt;[<span class="keyword">ASC</span>或<span class="keyword">DESC</span>]]</span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-2-排序"><a href="#9-7-1-2-排序" class="headerlink" title="9.7.1.2 排序"></a>9.7.1.2 排序</h4><ul>
<li><p>查询北京的学生信息，并按ID正序排列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">name</span>,idcard,age,city</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> home= <span class="string">'北京'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span> <span class="keyword">asc</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="10.png" alt=""></p>
<h4 id="9-7-1-3-别名"><a href="#9-7-1-3-别名" class="headerlink" title="9.7.1.3 别名"></a>9.7.1.3 别名</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">name</span>,idcard,age,city <span class="keyword">AS</span> home</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> city= <span class="string">'山东'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span> <span class="keyword">asc</span></span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-4-查询空行"><a href="#9-7-1-4-查询空行" class="headerlink" title="9.7.1.4 查询空行"></a>9.7.1.4 查询空行</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">name</span>,age,city</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> city <span class="keyword">is</span> <span class="literal">null</span> <span class="keyword">or</span> city =<span class="string">''</span></span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-5-常量列"><a href="#9-7-1-5-常量列" class="headerlink" title="9.7.1.5 常量列"></a>9.7.1.5 常量列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">name</span>,age,city,<span class="string">'中国'</span> <span class="keyword">as</span> country</span><br><span class="line"><span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-6-限制返回的行数"><a href="#9-7-1-6-限制返回的行数" class="headerlink" title="9.7.1.6 限制返回的行数"></a>9.7.1.6 限制返回的行数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">name</span>,age,city,<span class="string">'中国'</span> <span class="keyword">as</span> country</span><br><span class="line"><span class="keyword">FROM</span> student <span class="keyword">limit</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-7-DISTINCT"><a href="#9-7-1-7-DISTINCT" class="headerlink" title="9.7.1.7 DISTINCT"></a>9.7.1.7 DISTINCT</h4><ul>
<li><p>查询同学们一共来自哪些不同的城市</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">name</span>,age,<span class="keyword">DISTINCT</span> city,<span class="string">'中国'</span> <span class="keyword">as</span> country</span><br><span class="line"><span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="9-7-1-8"><a href="#9-7-1-8" class="headerlink" title="9.7.1.8 +"></a>9.7.1.8 +</h4><ul>
<li><p>在MYSQL中+号只能用作于数字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>+<span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>+<span class="string">'1'</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>+<span class="string">'zfpx'</span>  </span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>+<span class="literal">null</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(last_name,first_name) <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="9-7-1-7-练习"><a href="#9-7-1-7-练习" class="headerlink" title="9.7.1.7 练习"></a>9.7.1.7 练习</h3><h4 id="9-7-1-7-1-准备数据"><a href="#9-7-1-7-1-准备数据" class="headerlink" title="9.7.1.7.1 准备数据"></a>9.7.1.7.1 准备数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`student`</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="string">`province`</span>  <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="literal">NULL</span> <span class="keyword">AFTER</span> <span class="string">`city`</span>,</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="string">`birthday`</span>  <span class="built_in">date</span> <span class="literal">NULL</span> <span class="keyword">AFTER</span> <span class="string">`province`</span>,</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="string">`gender`</span>   <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span> <span class="keyword">AFTER</span> <span class="string">`birthday`</span>,</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="string">`email`</span>  <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="literal">NULL</span> <span class="keyword">AFTER</span> <span class="string">`gender`</span>;</span><br></pre></td></tr></table></figure>

<p><img src="11.png" alt="studenttable"> <img src="12.png" alt="coursetable"> <img src="13.png" alt="scoretable"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`student`</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,gender,age,city,province,birthday,idcard,email) <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'郭靖'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'济南'</span>, <span class="string">'山东省'</span>, <span class="string">'1982-09-03'</span>, <span class="number">1</span>, <span class="string">'1@qq.com'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`student`</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,gender,age,city,province,birthday,idcard,email) <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'黄蓉'</span>, <span class="string">'2'</span>, <span class="string">'2'</span>, <span class="string">'济南'</span>, <span class="string">'山东省'</span>, <span class="string">'1982-09-03'</span>, <span class="number">0</span>, <span class="string">'2@qq.com'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`student`</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,gender,age,city,province,birthday,idcard,email) <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'杨过'</span>, <span class="string">'3'</span>, <span class="string">'3'</span>, <span class="string">'终南山'</span>, <span class="string">'陕西省'</span>, <span class="string">'1979-09-03'</span>, <span class="number">1</span>, <span class="string">'3@qq.com'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`student`</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,gender,age,city,province,birthday,idcard,email) <span class="keyword">VALUES</span> (<span class="string">'4'</span>, <span class="string">'小龙女'</span>, <span class="string">'4'</span>, <span class="string">'4'</span>, <span class="string">'终南山'</span>, <span class="string">'陕西省'</span>, <span class="string">'1970-09-03'</span>, <span class="number">0</span>, <span class="string">'4@qq.com'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`student`</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,gender,age,city,province,birthday,idcard,email) <span class="keyword">VALUES</span> (<span class="string">'5'</span>, <span class="string">'欧阳锋'</span>, <span class="string">'5'</span>, <span class="string">'5'</span>, <span class="string">'白驼山'</span>, <span class="string">'新疆'</span>, <span class="string">'1989-09-09'</span>, <span class="number">1</span>, <span class="string">'5@qq.com'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`course`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'语文'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`course`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'数学'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`course`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'英语'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'100'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'90'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="string">'70'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'1'</span>, <span class="string">'100'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'2'</span>, <span class="string">'90'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'80'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'1'</span>, <span class="string">'100'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'2'</span>, <span class="string">'90'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`score`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'3'</span>, <span class="string">'80'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-7-2-查询山东省的同学全部信息"><a href="#9-7-1-7-2-查询山东省的同学全部信息" class="headerlink" title="9.7.1.7.2 查询山东省的同学全部信息"></a>9.7.1.7.2 查询山东省的同学全部信息</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> province = <span class="string">'山东'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-7-3-查询山东省的男同学的全部信息"><a href="#9-7-1-7-3-查询山东省的男同学的全部信息" class="headerlink" title="9.7.1.7.3 查询山东省的男同学的全部信息"></a>9.7.1.7.3 查询山东省的男同学的全部信息</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> province = <span class="string">'山东'</span> <span class="keyword">and</span> gender=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-7-4-查询没有填写电子邮箱的同学的姓名和身份证号"><a href="#9-7-1-7-4-查询没有填写电子邮箱的同学的姓名和身份证号" class="headerlink" title="9.7.1.7.4 查询没有填写电子邮箱的同学的姓名和身份证号"></a>9.7.1.7.4 查询没有填写电子邮箱的同学的姓名和身份证号</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>,idcard <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> email <span class="keyword">IS</span> <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="9-7-1-8-排序"><a href="#9-7-1-8-排序" class="headerlink" title="9.7.1.8 排序"></a>9.7.1.8 排序</h3><h4 id="9-7-1-8-1-把学生的分数按升序排列"><a href="#9-7-1-8-1-把学生的分数按升序排列" class="headerlink" title="9.7.1.8.1 把学生的分数按升序排列"></a>9.7.1.8.1 把学生的分数按升序排列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">order</span> <span class="keyword">by</span> grade <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-8-2-把学生的分数按降序排列"><a href="#9-7-1-8-2-把学生的分数按降序排列" class="headerlink" title="9.7.1.8.2 把学生的分数按降序排列"></a>9.7.1.8.2 把学生的分数按降序排列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">order</span> <span class="keyword">by</span> grade <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<h4 id="9-7-1-8-3-课程编号按升序，成绩按降序"><a href="#9-7-1-8-3-课程编号按升序，成绩按降序" class="headerlink" title="9.7.1.8.3 课程编号按升序，成绩按降序"></a>9.7.1.8.3 课程编号按升序，成绩按降序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">order</span> <span class="keyword">by</span> course_id <span class="keyword">asc</span>, grade <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<h2 id="9-8-函数"><a href="#9-8-函数" class="headerlink" title="9.8 函数"></a>9.8 函数</h2><h3 id="9-8-1-字符函数"><a href="#9-8-1-字符函数" class="headerlink" title="9.8.1 字符函数"></a>9.8.1 字符函数</h3><table>
<thead>
<tr>
<th align="left">函数名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CONCAT</td>
<td align="left">字符串连接</td>
</tr>
<tr>
<td align="left">CONCAT_WS</td>
<td align="left">使用指定的分隔符进行字符连接</td>
</tr>
<tr>
<td align="left">FORMAT</td>
<td align="left">数字格式化</td>
</tr>
<tr>
<td align="left">LOWER</td>
<td align="left">转小写字母</td>
</tr>
<tr>
<td align="left">UPPER</td>
<td align="left">转大写字母</td>
</tr>
<tr>
<td align="left">LEFT</td>
<td align="left">返回字符串s开始的最左边n个字符</td>
</tr>
<tr>
<td align="left">RIGHT</td>
<td align="left">返回字符串s开始的最左边n个字符</td>
</tr>
</tbody></table>
<h4 id="9-8-1-1-LENGTH"><a href="#9-8-1-1-LENGTH" class="headerlink" title="9.8.1.1 LENGTH"></a>9.8.1.1 LENGTH</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="string">'zfpx'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="string">'珠峰培训'</span>);</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">like</span> <span class="string">'%char%'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-2-拼接字符串-CONCAT"><a href="#9-8-1-2-拼接字符串-CONCAT" class="headerlink" title="9.8.1.2 拼接字符串 [CONCAT]"></a>9.8.1.2 拼接字符串 [CONCAT]</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(last_name,<span class="string">'_'</span>,first_name) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-3-拼接字符串-UPPER"><a href="#9-8-1-3-拼接字符串-UPPER" class="headerlink" title="9.8.1.3 拼接字符串 [UPPER]"></a>9.8.1.3 拼接字符串 [UPPER]</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">UPPER</span>(<span class="string">'zfpx'</span>) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-4-拼接字符串-LOWER"><a href="#9-8-1-4-拼接字符串-LOWER" class="headerlink" title="9.8.1.4 拼接字符串 [LOWER]"></a>9.8.1.4 拼接字符串 [LOWER]</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOWER</span>(<span class="string">'ZFPX'</span>) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-5-截取字符串-SUBSTR"><a href="#9-8-1-5-截取字符串-SUBSTR" class="headerlink" title="9.8.1.5 截取字符串 [SUBSTR]"></a>9.8.1.5 截取字符串 [SUBSTR]</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">'zfpx'</span>,<span class="number">2</span>);<span class="comment">-- 截取从指定索引处开始的所有的字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">'zfpx'</span>,<span class="number">2</span>,<span class="number">3</span>);<span class="comment">--截取从指定索引处开始的指定数量的字符</span></span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-6-姓名的首字符大写，其它字符小写然后用-拼接"><a href="#9-8-1-6-姓名的首字符大写，其它字符小写然后用-拼接" class="headerlink" title="9.8.1.6 姓名的首字符大写，其它字符小写然后用_拼接"></a>9.8.1.6 姓名的首字符大写，其它字符小写然后用_拼接</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="keyword">UPPER</span>(<span class="keyword">SUBSTR</span>(last_name,<span class="number">1</span>,<span class="number">1</span>)),<span class="string">'_'</span>,<span class="keyword">LOWER</span>(<span class="keyword">SUBSTR</span>(last_name,<span class="number">2</span>)));</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-7-返回子串在原始字符串的起始索引"><a href="#9-8-1-7-返回子串在原始字符串的起始索引" class="headerlink" title="9.8.1.7 返回子串在原始字符串的起始索引"></a>9.8.1.7 返回子串在原始字符串的起始索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSTR</span>(<span class="string">'zfpx'</span>,<span class="string">'f'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-8-去掉左右空格-TRIM"><a href="#9-8-1-8-去掉左右空格-TRIM" class="headerlink" title="9.8.1.8 去掉左右空格[TRIM]"></a>9.8.1.8 去掉左右空格[TRIM]</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRIM</span>(<span class="string">'  zfpx  '</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LTRIM</span>(<span class="string">'  zfpx  '</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(<span class="string">'  zfpx  '</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRIM</span>(<span class="string">'x'</span> <span class="keyword">FROM</span> <span class="string">'xxzfpxxx'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-9-用空格补齐-LPAD"><a href="#9-8-1-9-用空格补齐-LPAD" class="headerlink" title="9.8.1.9 用空格补齐[LPAD]"></a>9.8.1.9 用空格补齐[LPAD]</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LPAD</span>(<span class="string">'zfpx'</span>,<span class="number">10</span>,<span class="string">'@'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LPAD</span>(<span class="string">'1'</span>,<span class="number">8</span>,<span class="string">'0'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">'1'</span>,<span class="number">8</span>,<span class="string">'0'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-10-替换"><a href="#9-8-1-10-替换" class="headerlink" title="9.8.1.10 替换"></a>9.8.1.10 替换</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">REPLACE</span>(<span class="string">'zfpx'</span>,<span class="string">'f'</span>,<span class="string">'q'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-11-FORMAT"><a href="#9-8-1-11-FORMAT" class="headerlink" title="9.8.1.11 FORMAT"></a>9.8.1.11 FORMAT</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FORMAT</span>(<span class="number">100000</span>,<span class="number">2</span>); 100,000.00</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">format</span>(<span class="number">100.31111</span>,<span class="number">2</span>) <span class="number">100.31</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">format</span>(<span class="number">100.31111</span>,<span class="number">0</span>); 100</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FORMAT</span>(<span class="number">423423234.65534453</span>,<span class="number">2</span>); 423,423,234.66</span><br></pre></td></tr></table></figure>

<h4 id="9-8-1-12-LEFT-RIGHT"><a href="#9-8-1-12-LEFT-RIGHT" class="headerlink" title="9.8.1.12 LEFT RIGHT"></a>9.8.1.12 LEFT RIGHT</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">left</span>(<span class="string">'abcde12345'</span>,<span class="number">5</span>);   //abcde</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">left</span>(<span class="string">'abcde12345'</span>,<span class="number">5</span>);   //12345</span><br></pre></td></tr></table></figure>

<h3 id="9-8-2-数学函数"><a href="#9-8-2-数学函数" class="headerlink" title="9.8.2 数学函数"></a>9.8.2 数学函数</h3><table>
<thead>
<tr>
<th align="left">函数名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CEIL</td>
<td align="left">向上取整</td>
</tr>
<tr>
<td align="left">FLOOR</td>
<td align="left">向下取整数</td>
</tr>
<tr>
<td align="left">DIV</td>
<td align="left">整数取</td>
</tr>
<tr>
<td align="left">MOD</td>
<td align="left">取余(取模)</td>
</tr>
<tr>
<td align="left">POWER</td>
<td align="left">幂运算</td>
</tr>
<tr>
<td align="left">ROUND</td>
<td align="left">四舍五入</td>
</tr>
<tr>
<td align="left">TRUNCATE</td>
<td align="left">数字截取</td>
</tr>
</tbody></table>
<h4 id="9-8-2-1-四舍五入"><a href="#9-8-2-1-四舍五入" class="headerlink" title="9.8.2.1 四舍五入"></a>9.8.2.1 四舍五入</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">2.5</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">2.555</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-2-2-向上取整"><a href="#9-8-2-2-向上取整" class="headerlink" title="9.8.2.2 向上取整"></a>9.8.2.2 向上取整</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">1.00</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-2-3-向下取整"><a href="#9-8-2-3-向下取整" class="headerlink" title="9.8.2.3 向下取整"></a>9.8.2.3 向下取整</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">1.00</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-2-4-截断"><a href="#9-8-2-4-截断" class="headerlink" title="9.8.2.4 截断"></a>9.8.2.4 截断</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1.66</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-2-5-取余"><a href="#9-8-2-5-取余" class="headerlink" title="9.8.2.5 取余"></a>9.8.2.5 取余</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">mod</span>(<span class="number">10</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="9-8-3-日期函数"><a href="#9-8-3-日期函数" class="headerlink" title="9.8.3 日期函数"></a>9.8.3 日期函数</h3><table>
<thead>
<tr>
<th align="left">函数名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NOW</td>
<td align="left">当前日期和时间</td>
</tr>
<tr>
<td align="left">CURDATE</td>
<td align="left">当前日期</td>
</tr>
<tr>
<td align="left">CURTIME</td>
<td align="left">当前时间</td>
</tr>
<tr>
<td align="left">DATE_ADD</td>
<td align="left">日期变化</td>
</tr>
<tr>
<td align="left">DATEDIFF</td>
<td align="left">计算日期差</td>
</tr>
<tr>
<td align="left">DATE_FORMAT</td>
<td align="left">日期格式化</td>
</tr>
</tbody></table>
<h4 id="9-8-3-1-返回日期时间"><a href="#9-8-3-1-返回日期时间" class="headerlink" title="9.8.3.1 返回日期时间"></a>9.8.3.1 返回日期时间</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOW</span>():</span><br></pre></td></tr></table></figure>

<h4 id="9-8-3-2-返回日期"><a href="#9-8-3-2-返回日期" class="headerlink" title="9.8.3.2 返回日期"></a>9.8.3.2 返回日期</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURDATE</span>():</span><br></pre></td></tr></table></figure>

<h4 id="9-8-3-3-返回日期"><a href="#9-8-3-3-返回日期" class="headerlink" title="9.8.3.3 返回日期"></a>9.8.3.3 返回日期</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURTIME</span>():</span><br></pre></td></tr></table></figure>

<h4 id="9-8-3-4-返回日期中指定的部分"><a href="#9-8-3-4-返回日期中指定的部分" class="headerlink" title="9.8.3.4 返回日期中指定的部分"></a>9.8.3.4 返回日期中指定的部分</h4><p>年 月 日 小时 分钟 秒</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(<span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">SELECT</span> MONTHNAME(<span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(<span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">HOUR</span>(<span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MINUTE</span>(<span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SECOND</span>(<span class="keyword">NOW</span>());</span><br></pre></td></tr></table></figure>

<h4 id="9-8-3-5-str-to-date"><a href="#9-8-3-5-str-to-date" class="headerlink" title="9.8.3.5 str_to_date"></a>9.8.3.5 str_to_date</h4><p>将日期格式的字符串转成指定格式的日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">STR_TO_DATE</span>(<span class="string">'2018-09-09'</span>,<span class="string">'%Y-%m-%d'</span>)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">格式符</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">%Y</td>
<td align="left">4位的年份</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">%y</td>
<td align="left">2位的年份</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">%m</td>
<td align="left">月份(01,02)</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">%c</td>
<td align="left">月份(1,2)</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">%d</td>
<td align="left">日(01,02)</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">%H</td>
<td align="left">小时(24小时制)</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">%h</td>
<td align="left">小时(12小时制)</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">%i</td>
<td align="left">分钟(00,01)</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">%s</td>
<td align="left">秒(00,01)</td>
</tr>
</tbody></table>
<h4 id="9-8-3-6"><a href="#9-8-3-6" class="headerlink" title="9.8.3.6"></a>9.8.3.6</h4><p>查询入职日期为1984-8-4的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> hiredate = <span class="keyword">STR_TO_DATE</span>(<span class="string">'12-30 1984'</span>,<span class="string">'%m-%d %Y'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-3-7-DATE-FORMAT"><a href="#9-8-3-7-DATE-FORMAT" class="headerlink" title="9.8.3.7 DATE_FORMAT"></a>9.8.3.7 DATE_FORMAT</h4><p>将日期转换成指定字符串</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(),<span class="string">'%Y年%m月%d日'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="9-8-3-8-DATE-ADD"><a href="#9-8-3-8-DATE-ADD" class="headerlink" title="9.8.3.8 DATE_ADD"></a>9.8.3.8 DATE_ADD</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_ADD</span>(<span class="keyword">NOW</span>(),<span class="built_in">INTERVAL</span> <span class="number">365</span> <span class="keyword">DAY</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_ADD</span>(<span class="keyword">NOW</span>(),<span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_ADD</span>(<span class="keyword">NOW</span>(),<span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-3-9-DATEDIFF"><a href="#9-8-3-9-DATEDIFF" class="headerlink" title="9.8.3.9 DATEDIFF"></a>9.8.3.9 DATEDIFF</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATEDIFF</span>(<span class="string">'2019-1-1'</span>,<span class="keyword">NOW</span>());</span><br></pre></td></tr></table></figure>

<h3 id="9-8-4-其它函数"><a href="#9-8-4-其它函数" class="headerlink" title="9.8.4 其它函数"></a>9.8.4 其它函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONNECTION_ID();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATABASE</span>();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">VERSION</span>();</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">LAST_INSERT_ID</span>();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MD5</span>(<span class="string">'123456'</span>);//摘要算法</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">PASSWORD</span>(<span class="string">'123456'</span>);//修改当前用户的密码</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">User</span>,<span class="keyword">Password</span> <span class="keyword">from</span> mysql.user;</span><br></pre></td></tr></table></figure>

<h3 id="9-8-5-流程控制函数"><a href="#9-8-5-流程控制函数" class="headerlink" title="9.8.5 流程控制函数"></a>9.8.5 流程控制函数</h3><h4 id="9-8-5-1-IF"><a href="#9-8-5-1-IF" class="headerlink" title="9.8.5.1 IF"></a>9.8.5.1 IF</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="number">1</span>&gt;<span class="number">0</span>,<span class="string">'A'</span>,<span class="string">'B'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-8-5-2-CASE函数"><a href="#9-8-5-2-CASE函数" class="headerlink" title="9.8.5.2 CASE函数"></a>9.8.5.2 CASE函数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">CASE 要判断的字段和表达式</span><br><span class="line">WHEN 常量1 then 要显示的值或语句1</span><br><span class="line">WHEN 常量2 then 要显示的值或语句2</span><br><span class="line">ELSE 要显示的值</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">CASE</span> </span><br><span class="line"><span class="keyword">WHEN</span> grade&lt;<span class="number">60</span> <span class="keyword">then</span> <span class="string">'不及格'</span></span><br><span class="line"><span class="keyword">WHEN</span> grade&gt;=<span class="number">60</span> <span class="keyword">then</span> <span class="string">'及格'</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">'未知'</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">FROM</span> score;</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">level</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">'A'</span> <span class="keyword">then</span> <span class="string">'优秀'</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">'B'</span> <span class="keyword">then</span> <span class="string">'良好'</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">'未知'</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">FROM</span> score;</span><br></pre></td></tr></table></figure>

<h3 id="9-9-自定义函数"><a href="#9-9-自定义函数" class="headerlink" title="9.9 自定义函数"></a>9.9 自定义函数</h3><ul>
<li>自定义函数是对MySQL的扩展，使用方式和内置函数相同</li>
<li>函数必须要有参数和返回值</li>
<li>函数可以接收任意类型的值，也可以接收这些类型的参数</li>
<li>函数体由合法的SQL语句组成</li>
<li>函数体可以是简单的SELECT语句或INSERT语句，如果是复合结构要用BEGIN…END</li>
<li>函数体也可以包含声明，循环和流程控制</li>
<li>返回值只能有一个</li>
</ul>
<h4 id="9-9-1-语法"><a href="#9-9-1-语法" class="headerlink" title="9.9.1 语法"></a>9.9.1 语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> func_name() <span class="keyword">RETURNS</span>  <span class="built_in">VARCHAR</span>(<span class="number">64</span>)</span><br><span class="line"><span class="keyword">body</span></span><br></pre></td></tr></table></figure>

<h4 id="9-9-2-znow"><a href="#9-9-2-znow" class="headerlink" title="9.9.2 znow"></a>9.9.2 znow</h4><ul>
<li>注意函数名一定要跟着小括号表示参数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> znow() <span class="keyword">RETURNS</span> <span class="built_in">VARCHAR</span>(<span class="number">30</span>)</span><br><span class="line"><span class="keyword">RETURN</span> <span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(),<span class="string">'%Y年%m月%d日 %H点:%i分%s秒'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="9-9-3-zadd"><a href="#9-9-3-zadd" class="headerlink" title="9.9.3 zadd"></a>9.9.3 zadd</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> zadd(num1 <span class="built_in">INT</span>,num2 <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">RETURN</span> num1+num2;</span><br></pre></td></tr></table></figure>

<h4 id="9-9-4-addUser"><a href="#9-9-4-addUser" class="headerlink" title="9.9.4 addUser"></a>9.9.4 addUser</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stu(<span class="keyword">id</span> <span class="built_in">int</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,<span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>));</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> addUser(<span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>)) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> stu(<span class="keyword">name</span>) <span class="keyword">VALUES</span>(<span class="keyword">name</span>);</span><br><span class="line">  RETURN LAST_INSERT_ID();</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> addUser(<span class="string">'zfpx'</span>);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> addUser</span><br></pre></td></tr></table></figure>

<h3 id="9-10-模糊查询"><a href="#9-10-模糊查询" class="headerlink" title="9.10 模糊查询"></a>9.10 模糊查询</h3><p>就是查询的条件是模糊的，不是特别明确的</p>
<h4 id="9-10-1-通配符"><a href="#9-10-1-通配符" class="headerlink" title="9.10.1 通配符"></a>9.10.1 通配符</h4><p>代替一个或多个真正的字符，与LIKE 关键字一起使用</p>
<ul>
<li><code>_</code>表示一个任意字符</li>
<li><code>%</code>表示任意长度的字符串</li>
</ul>
<h4 id="9-10-2-BETWEEN-AND"><a href="#9-10-2-BETWEEN-AND" class="headerlink" title="9.10.2 BETWEEN AND"></a>9.10.2 BETWEEN AND</h4><p>查询某一列在指定的规范内的记录，包括两个边界</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score <span class="keyword">where</span> grade <span class="keyword">between</span> <span class="number">80</span> <span class="keyword">and</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>

<h4 id="9-10-3-IN"><a href="#9-10-3-IN" class="headerlink" title="9.10.3 IN"></a>9.10.3 IN</h4><p>查询某一列中的值在列出的内容列表中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> city <span class="keyword">in</span> (<span class="string">'北京'</span>,<span class="string">'上海'</span>,<span class="string">'广东'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="9-10-4-IS-NUL"><a href="#9-10-4-IS-NUL" class="headerlink" title="9.10.4 IS NUL"></a>9.10.4 IS NUL</h4><ul>
<li>查询没有邮箱的 IS NUL</li>
<li>查询有邮箱的 IS NOT NULL</li>
</ul>
<h2 id="10-DCL"><a href="#10-DCL" class="headerlink" title="10. DCL"></a>10. DCL</h2><h3 id="10-1-创建用户"><a href="#10-1-创建用户" class="headerlink" title="10.1 创建用户"></a>10.1 创建用户</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER 用户名@访问地址 IDENTIFIED BY <span class="string">'密码'</span></span><br><span class="line">CREATE USER user1@localhost IDENTIFIED BY <span class="string">'123456'</span></span><br></pre></td></tr></table></figure>

<h3 id="10-2-授予权限"><a href="#10-2-授予权限" class="headerlink" title="10.2 授予权限"></a>10.2 授予权限</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRANT 权限<span class="number">1</span>,权限<span class="number">2</span>,,, ON 数据库.* TO 用户名</span><br><span class="line"></span><br><span class="line">GRANT CREATE,DROP ON db1.* TO user1@localhost;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-授予权限"><a href="#10-3-授予权限" class="headerlink" title="10.3 授予权限"></a>10.3 授予权限</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REVOKE 权限<span class="number">1</span>，权限<span class="number">2</span>，，，ON 数据库.* FROM 用户名;</span><br><span class="line">REVOKE CREATE,DROP ONT db1.* FROM user1@localhost;</span><br></pre></td></tr></table></figure>

<h3 id="10-4-查看用户权限"><a href="#10-4-查看用户权限" class="headerlink" title="10.4 查看用户权限"></a>10.4 查看用户权限</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW GRANTS FROM 用户名</span><br><span class="line">SHOW GRANTS FROM user1@localhost;</span><br></pre></td></tr></table></figure>

<h3 id="10-5-删除用户"><a href="#10-5-删除用户" class="headerlink" title="10.5 删除用户"></a>10.5 删除用户</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DROP USER 用户名</span><br><span class="line">DROP USER user1@localhost;</span><br></pre></td></tr></table></figure>

<h3 id="10-6-修改密码"><a href="#10-6-修改密码" class="headerlink" title="10.6 修改密码"></a>10.6 修改密码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE USER SET PASSWORD=PASSWORD(<span class="string">'password'</span>) WHERE User=<span class="string">'username'</span> and Host=<span class="string">'localhost'</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<h2 id="11-存储过程"><a href="#11-存储过程" class="headerlink" title="11. 存储过程"></a>11. 存储过程</h2><ul>
<li>大多数SQL语句都是针对一个或多个表的单条语句。但是并不是所有的操作都是可以用一条语句来完成的，经常有一些操作是需要多条语句配合才能完成。我们引入的存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它</li>
</ul>
<h3 id="11-1-语法"><a href="#11-1-语法" class="headerlink" title="11.1 语法"></a>11.1 语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE([[IN |OUT |INOUT ] 参数名 数据类形...])</span><br></pre></td></tr></table></figure>

<h3 id="11-2-调用"><a href="#11-2-调用" class="headerlink" title="11.2 调用"></a>11.2 调用</h3><ul>
<li><p>因为存储过程实际上是一种函数,所以存储过程名后需要有 () 符号(即使不传递参数也需要)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL Avg_Price()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="11-3-删除"><a href="#11-3-删除" class="headerlink" title="11.3 删除"></a>11.3 删除</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE IF EXISTS Avg_Price;</span><br></pre></td></tr></table></figure>

<h3 id="11-4-参数"><a href="#11-4-参数" class="headerlink" title="11.4 参数"></a>11.4 参数</h3><ul>
<li>存储过程并不显示结果，而是把结果返回给你指定的变量</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create procedure sum (<span class="keyword">in</span> a int,<span class="keyword">in</span> b int,out result int)</span><br><span class="line">begin</span><br><span class="line">select a+b INTO result;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">call sum5(<span class="number">1</span>,<span class="number">2</span>,@result);</span><br><span class="line">select @result;</span><br></pre></td></tr></table></figure>

<h2 id="12-索引"><a href="#12-索引" class="headerlink" title="12. 索引"></a>12. 索引</h2><ul>
<li>索引可以提高数据库的查询速度</li>
</ul>
<p><img src="14.jpeg" alt="treeindex"></p>
<h3 id="12-1-准备数据"><a href="#12-1-准备数据" class="headerlink" title="12.1 准备数据"></a>12.1 准备数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">-- 构建一个<span class="number">8388608</span>条记录的数据 </span><br><span class="line"></span><br><span class="line">-- 创建用户表</span><br><span class="line">create table user(</span><br><span class="line">  id int,</span><br><span class="line">    username varchar(<span class="number">64</span>),</span><br><span class="line">    userno int</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">-- 创建生成随机字符串的函数</span><br><span class="line">CREATE FUNCTION <span class="string">`rand_string`</span>(n INT) RETURNS varchar(<span class="number">255</span>)</span><br><span class="line">BEGIN </span><br><span class="line">DECLARE chars_str varchar(<span class="number">100</span>) DEFAULT <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>; </span><br><span class="line">DECLARE return_str varchar(<span class="number">255</span>) DEFAULT <span class="string">''</span>; </span><br><span class="line">DECLARE i INT DEFAULT <span class="number">0</span>; </span><br><span class="line">WHILE i &lt; n DO </span><br><span class="line">SET return_str = concat(return_str,substring(chars_str , FLOOR(<span class="number">1</span> + RAND()*<span class="number">62</span> ),<span class="number">1</span>)); </span><br><span class="line">SET i = i +<span class="number">1</span>; </span><br><span class="line">END WHILE; </span><br><span class="line">RETURN return_str; </span><br><span class="line">END; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 产生随机数字 </span><br><span class="line">create <span class="function"><span class="keyword">function</span> <span class="title">rand_num</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"><span class="title">returns</span> <span class="title">int</span>(<span class="params"><span class="number">5</span></span>) </span></span><br><span class="line"><span class="function"><span class="title">begin</span>  </span></span><br><span class="line"><span class="function"><span class="title">declare</span> <span class="title">i</span> <span class="title">int</span> <span class="title">default</span> 0; </span></span><br><span class="line"><span class="function"><span class="title">set</span> <span class="title">i</span> = <span class="title">floor</span>(<span class="params"><span class="number">10</span>+rand(</span>)*500); </span></span><br><span class="line"><span class="function"><span class="title">return</span> <span class="title">i</span>; </span></span><br><span class="line"><span class="function"><span class="title">end</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">-- 创建存储过程，向用户表添加海量数据 </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">create</span> <span class="title">procedure</span> <span class="title">insert_user</span>(<span class="params">in start int(<span class="number">10</span></span>),<span class="title">in</span> <span class="title">max_num</span> <span class="title">int</span>(<span class="params"><span class="number">10</span></span>))</span></span><br><span class="line"><span class="function"> <span class="title">begin</span></span></span><br><span class="line"><span class="function">   <span class="title">declare</span> <span class="title">i</span> <span class="title">int</span>;</span></span><br><span class="line"><span class="function">   <span class="title">set</span> <span class="title">i</span>=0;</span></span><br><span class="line"><span class="function">   <span class="title">while</span> <span class="title">i</span>&lt;<span class="title">max_num</span> <span class="title">do</span></span></span><br><span class="line"><span class="function">     <span class="title">set</span> <span class="title">i</span>=<span class="title">i</span>+1;</span></span><br><span class="line"><span class="function">         <span class="title">insert</span> <span class="title">into</span> <span class="title">user</span>(<span class="params">id,username,userno</span>) <span class="title">values</span>(<span class="params">(start+i</span>),<span class="title">rand_string</span>(<span class="params"><span class="number">6</span></span>),<span class="title">rand_num</span>(<span class="params"></span>));</span></span><br><span class="line"><span class="function">   <span class="title">end</span> <span class="title">while</span>;</span></span><br><span class="line"><span class="function"> <span class="title">end</span>;</span></span><br><span class="line"><span class="function"><span class="title">call</span> <span class="title">insert_user</span>(<span class="params"><span class="number">1</span>,<span class="number">8388608</span></span>);</span></span><br></pre></td></tr></table></figure>

<h3 id="12-2-创建普通索引"><a href="#12-2-创建普通索引" class="headerlink" title="12.2 创建普通索引"></a>12.2 创建普通索引</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table user(id int primary key,name varchar(<span class="number">32</span>),email varchar(<span class="number">32</span>));</span><br><span class="line">alter table user add index(name);</span><br><span class="line">create index idx_name on  user(name);</span><br></pre></td></tr></table></figure>

<h3 id="12-3-查看索引"><a href="#12-3-查看索引" class="headerlink" title="12.3 查看索引"></a>12.3 查看索引</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show index <span class="keyword">from</span> 表名;</span><br><span class="line">show index <span class="keyword">from</span> user</span><br></pre></td></tr></table></figure>

<h3 id="12-4-删除索引"><a href="#12-4-删除索引" class="headerlink" title="12.4 删除索引"></a>12.4 删除索引</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table 表名 drop primary;</span><br><span class="line">alter table 表名 drop index 索引名;</span><br><span class="line">drop index 索引名 on 表名;</span><br></pre></td></tr></table></figure>

<h3 id="12-5-慢查询"><a href="#12-5-慢查询" class="headerlink" title="12.5 慢查询"></a>12.5 慢查询</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain</span><br><span class="line">select * <span class="keyword">from</span> users where userno=<span class="number">4593</span>;</span><br><span class="line">alter table users add index(userno);</span><br></pre></td></tr></table></figure>

<p><img src="15.jpeg" alt="mysqlexplain"></p>
<h3 id="12-6-索引创建的原则"><a href="#12-6-索引创建的原则" class="headerlink" title="12.6 索引创建的原则"></a>12.6 索引创建的原则</h3><ul>
<li>比较频繁作为查询条件的字段应该创建索引</li>
<li>唯一性太差的字段不适合单独创建索引，即使频繁作为查询条件</li>
<li>更新非常频繁的字段不适合作创建索引</li>
<li>不会出现在where子句中的字段不该创建索引</li>
</ul>
<h2 id="13-什么是聚合函数"><a href="#13-什么是聚合函数" class="headerlink" title="13. 什么是聚合函数"></a>13. 什么是聚合函数</h2><p>对一组值进行计算，并返回计算后的值，一般用来统计数据</p>
<h3 id="1-1-SUM"><a href="#1-1-SUM" class="headerlink" title="1.1 SUM"></a>1.1 SUM</h3><p>累加所有行的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">计算ID=1的学生的的总分</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">SUM</span>(grade)  <span class="keyword">as</span> <span class="string">'总分'</span> <span class="keyword">from</span> score <span class="keyword">where</span> student_id = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-AVG"><a href="#1-2-AVG" class="headerlink" title="1.2 AVG"></a>1.2 AVG</h3><p>计算所有行的平均值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">计算ID=1的学生的的平均分</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">AVG</span>(grade) <span class="keyword">as</span> <span class="string">'平均分'</span> <span class="keyword">from</span> score <span class="keyword">where</span> student_id = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-MAX、MIN"><a href="#1-3-MAX、MIN" class="headerlink" title="1.3 MAX、MIN"></a>1.3 MAX、MIN</h3><ul>
<li>计算所有行的最大值和最小值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">MAX</span>(grade) 最高分,<span class="keyword">MIN</span>(grade) 最低分 <span class="keyword">from</span> score <span class="keyword">where</span> student_id = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-AVG"><a href="#1-4-AVG" class="headerlink" title="1.4 AVG"></a>1.4 AVG</h3><ul>
<li>计算所有行的平均值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">AVG</span>(grade) <span class="keyword">as</span> <span class="string">'平均分'</span> 最低分 <span class="keyword">from</span> score <span class="keyword">where</span> student_id = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1-5-COUNT"><a href="#1-5-COUNT" class="headerlink" title="1.5 COUNT"></a>1.5 COUNT</h3><ul>
<li>计算值不为NULL的行</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">COUNT</span>(*) <span class="keyword">from</span> student;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">from</span> student;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">COUNT</span>(<span class="keyword">name</span>) <span class="keyword">from</span> student;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">COUNT</span>(<span class="literal">NULL</span>) <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure>

<h2 id="14-分组"><a href="#14-分组" class="headerlink" title="14. 分组"></a>14. 分组</h2><p>分组查询就是按某列的值进行分组，相同的值分成一组，然后可以对此组内进行求平均、求和等计算</p>
<p><img src="16.png" alt="splitgroup"></p>
<h3 id="2-1-语法"><a href="#2-1-语法" class="headerlink" title="2.1 语法"></a>2.1 语法</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列名,查询表达式</span><br><span class="line"><span class="keyword">FROM</span>  &lt;表名&gt;  </span><br><span class="line"><span class="keyword">WHERE</span>  &lt;条件&gt;</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> &lt;分组字段&gt;</span><br><span class="line"><span class="keyword">HAVING</span> 分组后的过滤条件</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 列名 [<span class="keyword">ASC</span>,<span class="keyword">DESC</span>]</span><br><span class="line"><span class="keyword">LIMIT</span> 偏移量,条数</span><br></pre></td></tr></table></figure>

<p>SELECT列表中只能包含：</p>
<ul>
<li>被分组的列</li>
<li>为每个分组返回一个值的表达式，如聚合函数</li>
</ul>
<h3 id="2-2-练习"><a href="#2-2-练习" class="headerlink" title="2.2 练习"></a>2.2 练习</h3><ul>
<li><p>统计每位同学的平均成绩-单列分组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,<span class="keyword">avg</span>(grade) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> student_id;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计每门课程的最高分，并按分数从高到低排列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> course_id,<span class="keyword">max</span>(grade) 平均分 <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> course_id <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">max</span>(grade) <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>统计各省的男女同学人数-多列分组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> province,gender,<span class="keyword">COUNT</span>(*) <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> province,gender</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-3-分组筛选"><a href="#2-3-分组筛选" class="headerlink" title="2.3 分组筛选"></a>2.3 分组筛选</h3><h4 id="2-3-1-语法"><a href="#2-3-1-语法" class="headerlink" title="2.3.1 语法"></a>2.3.1 语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">FROM</span>  &lt;表名&gt;</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> &#123;col_name|expr|<span class="keyword">position</span>&#125;</span><br><span class="line"><span class="keyword">HAVING</span>  &#123;col_name|expr|<span class="keyword">position</span>&#125;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> &#123;col_name|expr|<span class="keyword">position</span>&#125; [<span class="keyword">ASC</span>|<span class="keyword">DESC</span>]</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="keyword">offset</span>,<span class="keyword">row_count</span></span><br></pre></td></tr></table></figure>

<ol>
<li>WHERE用于过滤掉不符合条件的记录</li>
<li>HAVING 用于过滤分组后的记录</li>
<li>GROUP BY用于对筛选后的结果进行分组</li>
</ol>
<h4 id="2-3-2-练习"><a href="#2-3-2-练习" class="headerlink" title="2.3.2 练习"></a>2.3.2 练习</h4><ul>
<li><p>统计学生人数超过1人的省份</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> province,<span class="keyword">COUNT</span>(*) <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> province <span class="keyword">having</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不及格次数大于1次的学生</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,<span class="keyword">COUNT</span>(*) 不及格次数 <span class="keyword">from</span> score <span class="keyword">where</span> grade &lt;<span class="number">60</span> <span class="keyword">group</span> <span class="keyword">by</span> student_id <span class="keyword">having</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="15-子查询"><a href="#15-子查询" class="headerlink" title="15. 子查询"></a>15. 子查询</h2><ul>
<li>子查询就是指出现在其它SQL语句中的SELECT语句,必须始终出现在圆括号中</li>
<li>子查询可以包含多个关键字或条件</li>
<li>子查询的外层查询可以是: SELECT、INSERT、UPDATE、SET等</li>
<li>子查询可以返回常量、一行数据、一列数据或其它子查询</li>
</ul>
<h3 id="3-1-比较运算符的子查询"><a href="#3-1-比较运算符的子查询" class="headerlink" title="3.1 比较运算符的子查询"></a>3.1 比较运算符的子查询</h3><ul>
<li>= 等于</li>
<li><code>&gt;</code> 大于</li>
<li>&lt; 小于</li>
<li><code>&gt;</code>= 大于等于</li>
<li>&lt;= 小于等于</li>
<li>&lt;&gt; 不等于</li>
<li>!= 不等于</li>
<li>&lt;=&gt; 安全不等于</li>
</ul>
<h3 id="3-2-查询年龄大于平均年龄的学生"><a href="#3-2-查询年龄大于平均年龄的学生" class="headerlink" title="3.2 查询年龄大于平均年龄的学生"></a>3.2 查询年龄大于平均年龄的学生</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="keyword">AVG</span>(age),<span class="number">2</span>) <span class="keyword">FROM</span> student; </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student <span class="keyword">WHERE</span> age &gt; (<span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="keyword">AVG</span>(age),<span class="number">2</span>) <span class="keyword">FROM</span> student)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-ANY-SOME-ALL"><a href="#3-2-ANY-SOME-ALL" class="headerlink" title="3.2 ANY SOME ALL"></a>3.2 ANY SOME ALL</h3><ul>
<li><blockquote>
<blockquote>
<p>= &lt; &lt;= = &lt;&gt; !=</p>
</blockquote>
</blockquote>
</li>
<li><p>ANY 任何一个</p>
</li>
<li><p>SOME 某些</p>
</li>
<li><p>ALL 全部</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">年龄大于陕西省任何一位同学</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student <span class="keyword">WHERE</span> age &gt; <span class="keyword">ANY</span> (<span class="keyword">SELECT</span> age  <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> province = <span class="string">'陕西省'</span>);</span><br><span class="line">年龄大于陕西省某些同学</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student <span class="keyword">WHERE</span> age &gt; <span class="keyword">SOME</span> (<span class="keyword">SELECT</span> age  <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> province = <span class="string">'陕西省'</span>);</span><br><span class="line">年龄大于陕西省所有同学</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student <span class="keyword">WHERE</span> age &gt; <span class="keyword">ALL</span> (<span class="keyword">SELECT</span> age  <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> province = <span class="string">'陕西省'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-3-查询一下有考试成绩的学生信息"><a href="#3-3-查询一下有考试成绩的学生信息" class="headerlink" title="3.3 查询一下有考试成绩的学生信息"></a>3.3 查询一下有考试成绩的学生信息</h3><ul>
<li>[IN]</li>
<li>[NOT IN]</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">SELECT</span> <span class="keyword">distinct</span> student_id <span class="keyword">from</span> score);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>[EXISTS]</p>
</li>
<li><p>[NOTEXISTS]</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">where</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="keyword">distinct</span> student_id <span class="keyword">from</span> score <span class="keyword">where</span> student.id = score.student_id  )</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="16-表连接"><a href="#16-表连接" class="headerlink" title="16. 表连接"></a>16. 表连接</h2><h3 id="4-1-连接类型"><a href="#4-1-连接类型" class="headerlink" title="4.1　连接类型"></a>4.1　连接类型</h3><ul>
<li>INNER JOIN 内连接</li>
<li>LEFT JOIN 左外连接</li>
<li>RIGHT JOIN 右外连接</li>
<li>ON 连接条件</li>
</ul>
<p><img src="17.jpeg" alt="tablejoin"></p>
<h3 id="4-2-连接条件"><a href="#4-2-连接条件" class="headerlink" title="4.2　连接条件"></a>4.2　连接条件</h3><p>使用ON关键字来设定连接条件，也可以使用WHERE来代替</p>
<ul>
<li>ON来设定连接条件</li>
<li>也可以使用WHERE来对结果进行过滤</li>
</ul>
<h3 id="4-3-内连接"><a href="#4-3-内连接" class="headerlink" title="4.3　内连接"></a>4.3　内连接</h3><p>显示左表和右表中符合条件的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">INNER</span> <span class="keyword">JOIN</span> score <span class="keyword">ON</span> student.id = score.student_id;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-左外连接"><a href="#4-4-左外连接" class="headerlink" title="4.4　左外连接"></a>4.4　左外连接</h3><p>显示左表的全部和右表符合条件的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score <span class="keyword">ON</span> student.id = score.student_id;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-右外连接"><a href="#4-5-右外连接" class="headerlink" title="4.5　右外连接"></a>4.5　右外连接</h3><p>显示右表的全部和左表符合条件的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> score <span class="keyword">ON</span> student.id = score.student_id;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-多表连接"><a href="#4-6-多表连接" class="headerlink" title="4.6　多表连接"></a>4.6　多表连接</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> student.name,course.name,score.grade <span class="keyword">FROM</span> score </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> student <span class="keyword">ON</span> student.id = score.student_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> course <span class="keyword">ON</span> course.id = score.course_id;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-无限分类-自身连接"><a href="#4-7-无限分类-自身连接" class="headerlink" title="4.7　无限分类[自身连接]"></a>4.7　无限分类[自身连接]</h3><h4 id="4-7-1-建表"><a href="#4-7-1-建表" class="headerlink" title="4.7.1 建表"></a>4.7.1 建表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">table</span> <span class="keyword">category</span>(</span><br><span class="line"> <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">11</span>) PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line"> parent_id <span class="built_in">int</span>(<span class="number">11</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="4-7-2-插入语句"><a href="#4-7-2-插入语句" class="headerlink" title="4.7.2 插入语句"></a>4.7.2 插入语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">category</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,parent_id)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'数码产品'</span>,<span class="number">0</span>),(<span class="number">2</span>,<span class="string">'服装'</span>,<span class="number">0</span>),(<span class="number">3</span>,<span class="string">'食品'</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="string">'iPad'</span>,<span class="number">1</span>),(<span class="number">5</span>,<span class="string">'李宁'</span>,<span class="number">2</span>),(<span class="number">6</span>,<span class="string">'康师傅'</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h4 id="4-7-3-查询所有的顶级分类下面分类的数量"><a href="#4-7-3-查询所有的顶级分类下面分类的数量" class="headerlink" title="4.7.3 查询所有的顶级分类下面分类的数量"></a>4.7.3 查询所有的顶级分类下面分类的数量</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c1.id,c1.name,<span class="keyword">COUNT</span>(<span class="number">1</span>) </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">category</span> c1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">category</span> c2 <span class="keyword">ON</span> c1.id = c2.parent_id</span><br><span class="line"><span class="keyword">WHERE</span> c1.parent_id = <span class="number">0</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c1.id;</span><br></pre></td></tr></table></figure>

<h4 id="4-7-4-父类变成名称"><a href="#4-7-4-父类变成名称" class="headerlink" title="4.7.4 父类变成名称"></a>4.7.4 父类变成名称</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c1.id,c1.name,p.name</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">category</span> c1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">category</span> p <span class="keyword">ON</span> c1.parent_id = p.id</span><br></pre></td></tr></table></figure>

<h3 id="4-8-删除重复记录-多表删除"><a href="#4-8-删除重复记录-多表删除" class="headerlink" title="4.8 删除重复记录[多表删除]"></a>4.8 删除重复记录[多表删除]</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">category</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,parent_id)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">7</span>,<span class="string">'iPad'</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="number">8</span>,<span class="string">'李宁'</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="number">9</span>,<span class="string">'康师傅'</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h4 id="4-8-1-子查询找要删除的ID"><a href="#4-8-1-子查询找要删除的ID" class="headerlink" title="4.8.1 子查询找要删除的ID"></a>4.8.1 子查询找要删除的ID</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">category</span> c1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">category</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="number">1</span>)&gt;<span class="number">1</span>) c2</span><br><span class="line"><span class="keyword">ON</span> c1.name = c2.name <span class="keyword">WHERE</span> c1.id != c2.id</span><br></pre></td></tr></table></figure>

<h4 id="4-8-2-通过IN找要删除的ID"><a href="#4-8-2-通过IN找要删除的ID" class="headerlink" title="4.8.2 通过IN找要删除的ID"></a>4.8.2 通过IN找要删除的ID</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">category</span> c1 </span><br><span class="line"><span class="keyword">WHERE</span> c1.name <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">category</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="number">1</span>)&gt;<span class="number">1</span>)</span><br><span class="line"><span class="keyword">AND</span> c1.id <span class="keyword">NOT</span> <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">category</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="number">1</span>)&gt;<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-8-3-删除重复记录"><a href="#4-8-3-删除重复记录" class="headerlink" title="4.8.3 删除重复记录"></a>4.8.3 删除重复记录</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">category</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">NAME</span> <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">category</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="number">1</span>)&gt;<span class="number">1</span>) <span class="keyword">AS</span> T1 )</span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(<span class="keyword">id</span>) <span class="keyword">id</span> <span class="keyword">from</span> <span class="keyword">category</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="number">1</span>)&gt;<span class="number">1</span>) <span class="keyword">AS</span> T2)</span><br></pre></td></tr></table></figure>

<h3 id="4-9-多表更新"><a href="#4-9-多表更新" class="headerlink" title="4.9 多表更新"></a>4.9 多表更新</h3><h4 id="4-9-1-插入省份-INSERT-SELECT"><a href="#4-9-1-插入省份-INSERT-SELECT" class="headerlink" title="4.9.1 (插入省份)INSERT SELECT"></a>4.9.1 (插入省份)INSERT SELECT</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> province(<span class="keyword">id</span> <span class="built_in">int</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> province(<span class="keyword">name</span>) <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> province <span class="keyword">FROM</span> student;</span><br></pre></td></tr></table></figure>

<h4 id="4-9-2-更新省份"><a href="#4-9-2-更新省份" class="headerlink" title="4.9.2　更新省份"></a>4.9.2　更新省份</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> student <span class="keyword">INNER</span> <span class="keyword">JOIN</span> province <span class="keyword">ON</span> student.province=province.name</span><br><span class="line"> <span class="keyword">SET</span> student.province=province.id</span><br></pre></td></tr></table></figure>

<h4 id="4-9-3-修改字段"><a href="#4-9-3-修改字段" class="headerlink" title="4.9.3 修改字段"></a>4.9.3 修改字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student </span><br><span class="line"><span class="keyword">CHANGE</span> <span class="keyword">COLUMN</span> <span class="string">`province`</span> <span class="string">`province_id`</span> <span class="built_in">int</span>(<span class="number">11</span>);</span><br></pre></td></tr></table></figure>





<h2 id="17-为什么需要设计数据库"><a href="#17-为什么需要设计数据库" class="headerlink" title="17. 为什么需要设计数据库"></a>17. 为什么需要设计数据库</h2><h3 id="1-1-良好的数据库设计"><a href="#1-1-良好的数据库设计" class="headerlink" title="1.1 良好的数据库设计"></a>1.1 良好的数据库设计</h3><ul>
<li>节省数据的存储空间</li>
<li>能够保证数据的完整性</li>
<li>方便进行数据库系统的开发</li>
</ul>
<h3 id="1-2-糟糕的数据库设计"><a href="#1-2-糟糕的数据库设计" class="headerlink" title="1.2 糟糕的数据库设计"></a>1.2 糟糕的数据库设计</h3><ul>
<li>数据冗余，存储空间浪费</li>
<li>内存空间浪费</li>
<li>数据和更新插入异常</li>
</ul>
<h2 id="18-软件项目开发周期中的数据库设计"><a href="#18-软件项目开发周期中的数据库设计" class="headerlink" title="18. 软件项目开发周期中的数据库设计"></a>18. 软件项目开发周期中的数据库设计</h2><ul>
<li>需求分析阶段: 分析客户的业务和数据处理需求</li>
<li>概要设计阶段： 设计数据库的E-R模型图，确认需求的正确和完整性</li>
<li>详细设计阶段： 应用三大范式审核数据库</li>
<li>代码编写阶段： 物理实现数据库，编码实现应用</li>
<li>软件测试阶段</li>
<li>安装部署</li>
</ul>
<blockquote>
<p>现实世界-&gt;信息世界-&gt;数据库模型图-&gt;数据库</p>
</blockquote>
<h2 id="19-设计数据库的步骤"><a href="#19-设计数据库的步骤" class="headerlink" title="19.设计数据库的步骤"></a>19.设计数据库的步骤</h2><h3 id="3-1-收集信息"><a href="#3-1-收集信息" class="headerlink" title="3.1 收集信息"></a>3.1 收集信息</h3><p>与相关人员进行交流、访谈充分了解用户需求，理解数据库需要完成的任务</p>
<h3 id="3-2-标示实体-Entity"><a href="#3-2-标示实体-Entity" class="headerlink" title="3.2 标示实体(Entity)"></a>3.2 标示实体(Entity)</h3><p>标识数据库要管理的关键对象或者实体，实体一般是名词</p>
<h3 id="3-3-标示实体的属性-Attribute"><a href="#3-3-标示实体的属性-Attribute" class="headerlink" title="3.3 标示实体的属性(Attribute)"></a>3.3 标示实体的属性(Attribute)</h3><h3 id="3-4-标示实体之间的关系-RelationShip"><a href="#3-4-标示实体之间的关系-RelationShip" class="headerlink" title="3.4 标示实体之间的关系(RelationShip)"></a>3.4 标示实体之间的关系(RelationShip)</h3><h2 id="20-数据库ER图"><a href="#20-数据库ER图" class="headerlink" title="20. 数据库ER图"></a>20. 数据库ER图</h2><p>ER图：实体关系图，简记E-R图，是指以实体、关系、属性三个基本概念概括数据的基本结构，从而描述静态数据结构的概念模式</p>
<p><img src="18.png" alt="er"></p>
<h3 id="4-1-ER图的实体（entity）"><a href="#4-1-ER图的实体（entity）" class="headerlink" title="4.1 ER图的实体（entity）"></a>4.1 ER图的实体（entity）</h3><ul>
<li>ER图的实体（entity）即数据模型中的数据对象，例如人、学生、音乐都可以作为一个数据对象，用长方体来表示</li>
</ul>
<h3 id="4-2-ER图的属性（attribute）"><a href="#4-2-ER图的属性（attribute）" class="headerlink" title="4.2 ER图的属性（attribute）"></a>4.2 ER图的属性（attribute）</h3><ul>
<li>ER图的属性（attribute）即数据对象所具有的属性，例如学生具有姓名、学号、年级等属性，用椭圆形表示</li>
<li>属性分为唯一属性（ unique attribute）和非唯一属性</li>
<li>唯一属性指的是唯一可用来标识该实体实例或者成员的属性，用下划线表示，一般来讲实体都至少有一个唯一属性。</li>
</ul>
<h3 id="4-3-ER图的关系（relationship）"><a href="#4-3-ER图的关系（relationship）" class="headerlink" title="4.3 ER图的关系（relationship）"></a>4.3 ER图的关系（relationship）</h3><ul>
<li>ER图的关系（relationship）用来表现数据对象与数据对象之间的联系</li>
<li>例如学生的实体和成绩表的实体之间有一定的联系，每个学生都有自己的成绩表，这就是一种关系，关系用菱形来表示。</li>
</ul>
<h3 id="4-4-ER图中关联关系"><a href="#4-4-ER图中关联关系" class="headerlink" title="4.4 ER图中关联关系"></a>4.4 ER图中关联关系</h3><h4 id="4-4-1-1对1-1-1"><a href="#4-4-1-1对1-1-1" class="headerlink" title="4.4.1 1对1 (1:1)"></a>4.4.1 1对1 (1:1)</h4><p>1对1关系是指对于实体集A与实体集B，A中的每一个实体至多与B中一个实体有关系；反之，在实体集B中的每个实体至多与实体集A中一个实体有关系。</p>
<h4 id="4-4-2-1对多（1-N）"><a href="#4-4-2-1对多（1-N）" class="headerlink" title="4.4.2 1对多（1:N）"></a>4.4.2 1对多（1:N）</h4><p>1对多关系是指实体集A与实体集B中至少有N(N&gt;0)个实体有关系；并且实体集B中每一个实体至多与实体集A中一个实体有关系。</p>
<p><img src="19.png" alt="er"></p>
<h4 id="4-4-3-多对多（M-N）"><a href="#4-4-3-多对多（M-N）" class="headerlink" title="4.4.3 多对多（M:N）"></a>4.4.3 多对多（M:N）</h4><p>多对多关系是指实体集A中的每一个实体与实体集B中至少有M(M&gt;0)个实体有关系，并且实体集B中的每一个实体与实体集A中的至少N（N&gt;0）个实体有关系。</p>
<p><img src="20.png" alt="er"></p>
<h2 id="21-数据库设计三大范式"><a href="#21-数据库设计三大范式" class="headerlink" title="21. 数据库设计三大范式"></a>21. 数据库设计三大范式</h2><h3 id="5-1-不合理的表设计"><a href="#5-1-不合理的表设计" class="headerlink" title="5.1 不合理的表设计"></a>5.1 不合理的表设计</h3><ul>
<li>信息重复</li>
<li>更新异常</li>
<li>插入异常</li>
<li>删除异常</li>
</ul>
<h3 id="5-2-三大范式"><a href="#5-2-三大范式" class="headerlink" title="5.2 三大范式"></a>5.2 三大范式</h3><h4 id="5-2-1-第一范式（1NF）"><a href="#5-2-1-第一范式（1NF）" class="headerlink" title="5.2.1 第一范式（1NF）"></a>5.2.1 第一范式（1NF）</h4><ul>
<li>数据表中的每一列（每个字段）必须是不可拆分的最小单元，也就是确保每一列的原子性；</li>
</ul>
<p><img src="21.png" alt="firstpattern"></p>
<h4 id="5-2-2-第二范式（2NF）"><a href="#5-2-2-第二范式（2NF）" class="headerlink" title="5.2.2 第二范式（2NF）"></a>5.2.2 第二范式（2NF）</h4><ul>
<li>满足1NF后，要求表中的所有列，都必须依赖于主键，而不能有任何一列与主键没有关系，也就是说一个表只描述一件事情</li>
</ul>
<p><img src="22.png" alt="image-20210510105807457"></p>
<p><img src="23.jpeg" alt="2th2"></p>
<p><img src="24.jpg" alt="2th3"></p>
<blockquote>
<p>一个人同时订几个房间，就会出来一个订单号多条数据，这样子联系人都是重复的，就会造成数据冗余</p>
</blockquote>
<h4 id="5-2-3-第三范式（3NF）"><a href="#5-2-3-第三范式（3NF）" class="headerlink" title="5.2.3 第三范式（3NF）"></a>5.2.3 第三范式（3NF）</h4><ul>
<li>必须先满足第二范式（2NF），要求：表中的每一列只与主键直接相关而不是间接相关，(表中的每一列只能依赖于主键)</li>
<li>数据不能存在传递关系,即每个属性都跟主键有直接关系而不是间接关系</li>
</ul>
<p><img src="25.png" alt="thirdpattern"></p>
<h4 id="5-2-4-如何更好的区分三大范式"><a href="#5-2-4-如何更好的区分三大范式" class="headerlink" title="5.2.4 如何更好的区分三大范式"></a>5.2.4 如何更好的区分三大范式</h4><ul>
<li>第一范式和第二范式的区别在于有没有分出两张表,第二范式是说一张表中包含了所种不同的实体属性，那么要必须分成多张表</li>
<li>第三范式是要求已经分成了多张表，那么一张表中只能有另一张表中的id（主键），而不能有其他的任何信息（其他的信息一律用外键在另一表的主键看查询）。</li>
</ul>
<h2 id="22-RBAC"><a href="#22-RBAC" class="headerlink" title="22.RBAC"></a>22.RBAC</h2><ul>
<li><p>基于角色的权限访问控制（Role-Based Access Control）</p>
</li>
<li><p>RBAC（Role-Based Access Control，基于角色的访问控制），就是用户通过角色与权限进行关联</p>
</li>
<li><p>简单地说，一个用户拥有若干角色，每一个角色拥有若干权限。这样，就构造成“用户-角色-权限-资源”的授权模型</p>
</li>
<li><p>在这种模型中，用户与角色之间，角色与权限之间，权限与资源之间一般是多对多的关系。</p>
</li>
<li><p>在RBAC中最重要的概念包括：用户(User)，角色(Role)，权限(Permission)，资源(Resource)</p>
<h3 id="5-1-安全原则"><a href="#5-1-安全原则" class="headerlink" title="5.1 安全原则"></a>5.1 安全原则</h3></li>
<li><p>最小权限原则之所以被RBAC所支持，是因为RBAC可以将其角色配置成其完成任务所需要的最小的权限集</p>
</li>
<li><p>责任分离原则可以通过调用相互独立互斥的角色来共同完成敏感的任务而体现，比如要求一个计帐员和财务管理员共参与同一过帐。</p>
</li>
<li><p>数据抽象可以通过权限的抽象来体现，如财务操作用借款、存款等抽象权限，而不用操作系统提供的典型的读、写、执行权限</p>
</li>
</ul>
<h3 id="5-2-ER图"><a href="#5-2-ER图" class="headerlink" title="5.2 ER图"></a>5.2 ER图</h3><p><img src="26.png" alt="er"></p>
<h3 id="5-2-1-用户表"><a href="#5-2-1-用户表" class="headerlink" title="5.2.1 用户表"></a>5.2.1 用户表</h3><table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">字段名</th>
<th align="left">类型</th>
<th align="left">默认</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">ID</td>
<td align="left">int(11)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">username</td>
<td align="left">用户名</td>
<td align="left">varchar(255)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">password</td>
<td align="left">密码</td>
<td align="left">varchar(255)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">email</td>
<td align="left">邮箱</td>
<td align="left">varchar(255)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">phone</td>
<td align="left">手机号</td>
<td align="left">varchar(255)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gender</td>
<td align="left">性别</td>
<td align="left">tinyint</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">birthday</td>
<td align="left">生日</td>
<td align="left">datetime</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">addresss</td>
<td align="left">地址</td>
<td align="left">varchar(255)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">create_time</td>
<td align="left">创建时间</td>
<td align="left">datetime</td>
<td align="left">CURRENT_TIMESTAMP</td>
</tr>
<tr>
<td align="left">last_login</td>
<td align="left">上次登录时间</td>
<td align="left">datetime</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">status</td>
<td align="left">状态</td>
<td align="left">tinyint</td>
<td align="left">1</td>
</tr>
</tbody></table>
<h3 id="5-2-2-角色表"><a href="#5-2-2-角色表" class="headerlink" title="5.2.2 角色表"></a>5.2.2 角色表</h3><table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">字段名</th>
<th align="left">类型</th>
<th align="left">默认</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">ID</td>
<td align="left">int(11)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">name</td>
<td align="left">名称</td>
<td align="left">varchar(255)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">create_time</td>
<td align="left">创建时间</td>
<td align="left">datetime</td>
<td align="left">CURRENT_TIMESTAMP</td>
</tr>
<tr>
<td align="left">status</td>
<td align="left">状态</td>
<td align="left">tinyint</td>
<td align="left">1</td>
</tr>
</tbody></table>
<h3 id="5-2-3-资源表"><a href="#5-2-3-资源表" class="headerlink" title="5.2.3 资源表"></a>5.2.3 资源表</h3><table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">字段名</th>
<th align="left">类型</th>
<th align="left">默认</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">ID</td>
<td align="left">int(11)</td>
<td align="left"></td>
<td></td>
</tr>
<tr>
<td align="left">name</td>
<td align="left">名称</td>
<td align="left">varchar(255)</td>
<td align="left"></td>
<td></td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">路径</td>
<td align="left">varchar(255)</td>
<td align="left"></td>
<td></td>
</tr>
<tr>
<td align="left">create_time</td>
<td align="left">创建时间</td>
<td align="left">datetime</td>
<td align="left">CURRENT_TIMESTAMP</td>
<td></td>
</tr>
<tr>
<td align="left">status</td>
<td align="left">状态</td>
<td align="left">tinyint</td>
<td align="left">1</td>
<td></td>
</tr>
</tbody></table>
<h3 id="5-2-4-用户角色表"><a href="#5-2-4-用户角色表" class="headerlink" title="5.2.4 用户角色表"></a>5.2.4 用户角色表</h3><table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">字段名</th>
<th align="left">类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">user_id</td>
<td align="left">用户ID</td>
<td align="left">int(11)</td>
</tr>
<tr>
<td align="left">role_id</td>
<td align="left">角色ID</td>
<td align="left">int(11)</td>
</tr>
</tbody></table>
<h3 id="5-2-5-角色资源"><a href="#5-2-5-角色资源" class="headerlink" title="5.2.5 角色资源"></a>5.2.5 角色资源</h3><table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">字段名</th>
<th align="left">类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">role_id</td>
<td align="left">角色ID</td>
<td align="left">int(11)</td>
</tr>
<tr>
<td align="left">resource_id</td>
<td align="left">资源ID</td>
<td align="left">int(11)</td>
</tr>
</tbody></table>
<h3 id="5-3-数据库脚本"><a href="#5-3-数据库脚本" class="headerlink" title="5.3 数据库脚本"></a>5.3 数据库脚本</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`categories`</span> <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="string">`fk_category_parent_id`</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`articles`</span> <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="string">`fk_article_category_id`</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span> <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="string">`fk_user_role_user_id`</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span> <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="string">`fk_user_role_role_id`</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`role_resource`</span> <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="string">`fk_role_resource_role_id`</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`role_resource`</span> <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="string">`fk_role_resource_resource_id`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`users`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`carousels`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`categories`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`articles`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`navigations`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`links`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`config`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`roles`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`resources`</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="string">`role_resource`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`users`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`last_login`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line"><span class="string">`email`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`gender`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`birthday`</span> datetime <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`carousels`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`categories`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`description`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`keywords`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line"><span class="string">`parent_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`articles`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`content`</span> <span class="built_in">text</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`keywords`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line"><span class="string">`pv`</span> <span class="built_in">int</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`navigations`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`links`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`logo`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`config`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`logo`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line"><span class="string">`keywords`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`description`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`icp`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`about`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`roles`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span> (</span><br><span class="line"><span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`role_id`</span> <span class="built_in">int</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`user_id`</span>, <span class="string">`role_id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`resources`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`key`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`create_time`</span> datetime <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line"><span class="string">`status`</span> <span class="built_in">tinyint</span>(<span class="number">255</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`role_resource`</span> (</span><br><span class="line"><span class="string">`role_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`resource_id`</span> <span class="built_in">int</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`role_id`</span>, <span class="string">`resource_id`</span>) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`categories`</span> <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="string">`fk_category_parent_id`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`parent_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`categories`</span> (<span class="string">`id`</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`articles`</span> <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="string">`fk_article_category_id`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`category_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`categories`</span> (<span class="string">`id`</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span> <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="string">`fk_user_role_user_id`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`user_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`users`</span> (<span class="string">`id`</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span> <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="string">`fk_user_role_role_id`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`role_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`roles`</span> (<span class="string">`id`</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`role_resource`</span> <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="string">`fk_role_resource_role_id`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`role_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`roles`</span> (<span class="string">`id`</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`role_resource`</span> <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="string">`fk_role_resource_resource_id`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`resource_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`resources`</span> (<span class="string">`id`</span>);</span><br></pre></td></tr></table></figure>

<h2 id="23-事务"><a href="#23-事务" class="headerlink" title="23.事务"></a>23.事务</h2><h3 id="6-1-为什么需要事务"><a href="#6-1-为什么需要事务" class="headerlink" title="6.1 为什么需要事务"></a>6.1 为什么需要事务</h3><ul>
<li>银行转账问题</li>
<li>A账户资金减少</li>
<li>B账户资金增加</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> bank;</span><br><span class="line"><span class="keyword">use</span> bank;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">account</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">64</span>),</span><br><span class="line">    balance <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">account</span>(<span class="keyword">name</span>,balance) <span class="keyword">values</span>(<span class="string">'张三'</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">account</span>(<span class="keyword">name</span>,balance) <span class="keyword">values</span>(<span class="string">'李四'</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance = balance - <span class="number">10</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">'张三'</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance = balance + <span class="number">10</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">'李四'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-什么是事务"><a href="#6-2-什么是事务" class="headerlink" title="6.2 什么是事务"></a>6.2 什么是事务</h3><ul>
<li>事务是作为单个逻辑工作单元执行的一系列操作</li>
<li>多个操作作为一个整体向系统提交，要么都执行，要么都不执行</li>
<li>事务是一个不可分割的工作逻辑单元</li>
</ul>
<blockquote>
<p>转账过程就是一个整体，它需要两条UPDATE语句，如果任何一个出错，则整个转账业务取消，两个账户的余额都恢复到原来的数据，确保总余额不变</p>
</blockquote>
<h3 id="6-3-事务的特性"><a href="#6-3-事务的特性" class="headerlink" title="6.3 事务的特性"></a>6.3 事务的特性</h3><ul>
<li>原子性(Atomicity) 事务是一个完整的操作，事务各个部分是不可分的，要么都执行，要么都不执行</li>
<li>一致性(Consistency) 当事务完成后，数据必须处理完整的状态</li>
<li>隔离性(Isolation) 并发事务彼此隔离、独立，它不应该以任何方式依赖于其它事务</li>
<li>持久性(Durability) 事务完成后，它对数据库的修改被永久保持</li>
</ul>
<h3 id="6-4-如何创建事务"><a href="#6-4-如何创建事务" class="headerlink" title="6.4 如何创建事务"></a>6.4 如何创建事务</h3><ul>
<li>开始事务 <code>START TRANSACTION</code> 或者 <code>BEGIN</code></li>
<li>提交事务 <code>COMMIT</code></li>
<li>回滚或者说撤销事务 <code>ROLLBACK</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance = balance - <span class="number">10</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">'张三'</span>;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>默认情况下，每条单独的SQL语句视为一个事务</li>
<li>关闭默认提交状态后，可手动开启、关闭事务</li>
<li>关闭/开启自动提交状态 <code>SET autocommit=0|1</code> 0关闭 1开启</li>
</ul>
<blockquote>
<p>关闭自动提交后，从下一条SQL语句开始开启新的事务，需要使用COMMIT或ROLLBACK结束该事务</p>
</blockquote>
<h2 id="24-在node中使用mysql"><a href="#24-在node中使用mysql" class="headerlink" title="24.在node中使用mysql"></a>24.在node中使用mysql</h2><ul>
<li><a href="https://www.npmjs.com/package/mysql" target="_blank" rel="noopener">mysql</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql</span><br></pre></td></tr></table></figure>

<h3 id="7-1-使用mysql"><a href="#7-1-使用mysql" class="headerlink" title="7.1 使用mysql"></a>7.1 使用mysql</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mysql      = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : <span class="string">'localhost'</span>,</span><br><span class="line">  user     : <span class="string">'me'</span>,</span><br><span class="line">  password : <span class="string">'secret'</span>,</span><br><span class="line">  database : <span class="string">'my_db'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">connection.connect();</span><br><span class="line"></span><br><span class="line">connection.query(<span class="string">'SELECT 1 + 1 AS solution'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The solution is: '</span>, results[<span class="number">0</span>].solution);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>

<h3 id="7-2-使用mysql连接池"><a href="#7-2-使用mysql连接池" class="headerlink" title="7.2 使用mysql连接池"></a>7.2 使用mysql连接池</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">var</span> pool  = mysql.createPool(&#123;</span><br><span class="line">  connectionLimit : <span class="number">10</span>,</span><br><span class="line">  host            : <span class="string">'example.org'</span>,</span><br><span class="line">  user            : <span class="string">'bob'</span>,</span><br><span class="line">  password        : <span class="string">'secret'</span>,</span><br><span class="line">  database        : <span class="string">'my_db'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">pool.query(<span class="string">'SELECT 1 + 1 AS solution'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The solution is: '</span>, results[<span class="number">0</span>].solution);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="7-3-使用mysql事务"><a href="#7-3-使用mysql事务" class="headerlink" title="7.3 使用mysql事务"></a>7.3 使用mysql事务</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">connection.beginTransaction(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123; <span class="keyword">throw</span> err; &#125;</span><br><span class="line">  connection.query(<span class="string">'INSERT INTO posts SET title=?'</span>, title, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> connection.rollback(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> error;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> log = <span class="string">'Post '</span> + results.insertId + <span class="string">' added'</span>;</span><br><span class="line"></span><br><span class="line">    connection.query(<span class="string">'INSERT INTO log SET data=?'</span>, log, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> connection.rollback(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">throw</span> error;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      connection.commit(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> connection.rollback(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'success!'</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="25-锁"><a href="#25-锁" class="headerlink" title="25.锁"></a>25.锁</h2><ul>
<li>锁时计算机协调多个进程或线程并发访问某一资源的机制</li>
</ul>
<h3 id="8-1-锁的分类"><a href="#8-1-锁的分类" class="headerlink" title="8.1 锁的分类"></a>8.1 锁的分类</h3><ul>
<li>从对数据库操作的类型分，分为读锁和写锁<ul>
<li>读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会互相影响</li>
<li>写锁（排它锁）：当前写操作没有完成前，它会阻断其他写锁和读锁</li>
</ul>
</li>
<li>从对数据操作的粒度分，分为<ul>
<li>表锁</li>
<li>行锁</li>
</ul>
</li>
</ul>
<h3 id="8-2-表锁"><a href="#8-2-表锁" class="headerlink" title="8.2 表锁"></a>8.2 表锁</h3><ul>
<li>表锁偏向<code>MyISAM</code>存储引擎，开销小，加锁快，锁定粒度大，发生锁冲突的概率最高，并发度最低</li>
</ul>
<h4 id="8-2-1-准备数据"><a href="#8-2-1-准备数据" class="headerlink" title="8.2.1 准备数据"></a>8.2.1 准备数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE <span class="string">`users`</span> (</span><br><span class="line">  <span class="string">`id`</span> int(<span class="number">11</span>) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`NAME`</span> varchar(<span class="number">20</span>) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (<span class="string">`id`</span>)</span><br><span class="line">) ENGINE=MyISAM DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO <span class="string">`users`</span> (<span class="string">`id`</span>, <span class="string">`NAME`</span>) VALUES (<span class="string">'1'</span>, <span class="string">'a'</span>);</span><br><span class="line">INSERT INTO <span class="string">`users`</span> (<span class="string">`id`</span>, <span class="string">`NAME`</span>) VALUES (<span class="string">'2'</span>, <span class="string">'b'</span>);</span><br><span class="line">INSERT INTO <span class="string">`users`</span> (<span class="string">`id`</span>, <span class="string">`NAME`</span>) VALUES (<span class="string">'3'</span>, <span class="string">'c'</span>);</span><br><span class="line">INSERT INTO <span class="string">`users`</span> (<span class="string">`id`</span>, <span class="string">`NAME`</span>) VALUES (<span class="string">'4'</span>, <span class="string">'d'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lock table 表名称 read(write),表名称<span class="number">2</span> read(write);</span><br><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>

<h4 id="8-2-2-加读锁"><a href="#8-2-2-加读锁" class="headerlink" title="8.2.2 加读锁"></a>8.2.2 加读锁</h4><table>
<thead>
<tr>
<th align="left">会话1</th>
<th align="left">会话2</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">lock table users read;</td>
<td align="left">连接数据库</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">select * from users;</td>
<td align="left">select * from users;</td>
<td align="left">都可以查询</td>
</tr>
<tr>
<td align="left">select * from role;</td>
<td align="left">select * from role;</td>
<td align="left">会话1不能查询没有锁定的表，会话2可以查询没有锁定的表或更新未锁定的表</td>
</tr>
<tr>
<td align="left">INSERT INTO <code>users</code> (<code>id</code>, <code>NAME</code>) VALUES (‘5’, ‘e’);</td>
<td align="left">INSERT INTO <code>users</code> (<code>id</code>, <code>NAME</code>) VALUES (‘5’, ‘e’);</td>
<td align="left">会话1插入或更新会提示错误，会话2插入或更新会提示等待</td>
</tr>
<tr>
<td align="left">unlock tables;</td>
<td align="left">INSERT INTO <code>users</code> (<code>id</code>, <code>NAME</code>) VALUES (‘5’, ‘e’);</td>
<td align="left">会话1释放锁后，会话2完成插入操作</td>
</tr>
</tbody></table>
<h4 id="8-2-3-加写锁"><a href="#8-2-3-加写锁" class="headerlink" title="8.2.3 加写锁"></a>8.2.3 加写锁</h4><table>
<thead>
<tr>
<th align="left">会话1</th>
<th align="left">会话2</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">lock table users write;</td>
<td align="left">连接数据库</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">select * from users;</td>
<td align="left">select * from users;</td>
<td align="left">会话1可以对锁定表进行插入更新和删除操作,会话2的查询操作也会被阻塞</td>
</tr>
<tr>
<td align="left">unlock tables;</td>
<td align="left"></td>
<td align="left">会话1释放锁，会话2返回结果</td>
</tr>
</tbody></table>
<blockquote>
<p>读锁会阻塞写，但是不会阻塞读。而写锁则会把读和写都阻塞</p>
</blockquote>
<h3 id="8-3-行锁"><a href="#8-3-行锁" class="headerlink" title="8.3 行锁"></a>8.3 行锁</h3><ul>
<li>行锁偏向InnoDB存储引擎，开销大，加锁慢，会出现死锁，锁定粒度最小，发生锁冲突的概率最低，并发度也最高</li>
<li>InnoDB与MYISAM的最大不同有两点：一是支持事务（TRANSACTION）；二是采用了行级锁</li>
</ul>
<h4 id="8-3-1-行锁支持事务"><a href="#8-3-1-行锁支持事务" class="headerlink" title="8.3.1 行锁支持事务"></a>8.3.1 行锁支持事务</h4><h5 id="8-3-1-1-并发事务处理带来的问题"><a href="#8-3-1-1-并发事务处理带来的问题" class="headerlink" title="8.3.1.1 并发事务处理带来的问题"></a>8.3.1.1 并发事务处理带来的问题</h5><h6 id="8-3-1-1-1-更新丢失（Lost-Update）"><a href="#8-3-1-1-1-更新丢失（Lost-Update）" class="headerlink" title="8.3.1.1.1 更新丢失（Lost Update）"></a>8.3.1.1.1 更新丢失（Lost Update）</h6><ul>
<li>当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题–最后的更新覆盖了由其他事务所做的更新。</li>
<li>后面的事务覆盖了前面的值,这是正常现象</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table account3 (id int,balance int) ENGINE=InnoDB;</span><br><span class="line">insert into account3(id,balance) values(<span class="number">1</span>,<span class="number">100</span>);</span><br><span class="line">insert into account3(id,balance) values(<span class="number">2</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">set</span> autocommit=0;</span><br><span class="line">begin;</span><br><span class="line">update account3 <span class="keyword">set</span> balance=90 where id=1;</span><br><span class="line">commit;</span><br><span class="line"><span class="keyword">set</span> autocommit=0;</span><br><span class="line">begin;</span><br><span class="line">update account3 <span class="keyword">set</span> balance=80 where id=1;</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h6 id="8-3-1-1-2-脏读（Dirty-Reads）"><a href="#8-3-1-1-2-脏读（Dirty-Reads）" class="headerlink" title="8.3.1.1.2 脏读（Dirty Reads）"></a>8.3.1.1.2 脏读（Dirty Reads）</h6><ul>
<li>一个事务正在对一条记录做修改，在这个事务完成并提交前，这条记录的数据就处于不一致的状态；这时，另一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些<code>脏</code>数据，并据此作进一步的处理，就会产生未提交的数据依赖关系。这种现象被形象的叫做<code>脏读</code>。</li>
<li>一句话：事务A读取到了事务B已经修改但尚未提交的数据，还在这个数据基础上做了操作。此时，如果B事务回滚，A读取的数据无效，不符合一致性要求。</li>
<li>脏读是事务B里面修改了数据 ,这是不正常的</li>
<li>解决办法：如果在第一个事务提交前，任何其他事务不可读取其修改过的值，则可 以避免该问题。</li>
</ul>
<p>修改日志的隔离级别</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- 支持的存储引擎</span><br><span class="line">SHOW ENGINES;</span><br><span class="line">-- 当前的数据库默认引擎</span><br><span class="line">SHOW VARIABLES LIKE <span class="string">'storage_engine'</span>;</span><br><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line">SET GLOBAL TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"></span><br><span class="line">SELECT @@global.tx_isolation;</span><br><span class="line">SELECT @@session.tx_isolation;</span><br><span class="line">SELECT @@tx_isolation;</span><br><span class="line">start TRANSACTION;</span><br><span class="line">insert into account3(id,balance) values(<span class="number">3</span>,<span class="number">100</span>);</span><br><span class="line">start TRANSACTION;</span><br><span class="line">select * <span class="keyword">from</span> account3;</span><br></pre></td></tr></table></figure>

<h6 id="8-3-1-1-3-不可重复读（Non-Repeatable-Reads）"><a href="#8-3-1-1-3-不可重复读（Non-Repeatable-Reads）" class="headerlink" title="8.3.1.1.3 不可重复读（Non-Repeatable Reads）"></a>8.3.1.1.3 不可重复读（Non-Repeatable Reads）</h6><ul>
<li>一个事务在读取某些数据后的某个时间，再次读取以前读过的数据，却发现其读出的数据已经发生了改变、或某些记录已经被删除了！这种现象就叫做”不可重复读”。</li>
<li>一句话：事务A读取到了事务B已经提交的修改数据，不符合隔离性,这是不正常的</li>
<li>解决办法：如果只有在修改事务完全提交之后才可以读取数据，则可以避免该问题</li>
<li>针对的是update或delete</li>
</ul>
<p>修改日志级别</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL read committed;</span><br><span class="line">SET GLOBAL TRANSACTION ISOLATION LEVEL read committed;</span><br><span class="line">SELECT @@global.tx_isolation;</span><br><span class="line">SELECT @@session.tx_isolation;</span><br><span class="line">SELECT @@tx_isolation;</span><br></pre></td></tr></table></figure>

<p>会话2</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start TRANSACTION;</span><br><span class="line">select * <span class="keyword">from</span> account3;</span><br></pre></td></tr></table></figure>

<p>会话2</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start TRANSACTION;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> account3 where id=<span class="number">1</span>;</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<h6 id="8-3-1-1-4-幻读（Phantom-Reads）"><a href="#8-3-1-1-4-幻读（Phantom-Reads）" class="headerlink" title="8.3.1.1.4 幻读（Phantom Reads）"></a>8.3.1.1.4 幻读（Phantom Reads）</h6><ul>
<li>一个事务按相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据，这种现象就称为”幻读”。</li>
<li>一句话：事务A读取到了事务B提交的新增数据，不符合隔离性</li>
<li>幻读是事务B里面新增了数据,这是不正常的</li>
<li>解决办法：如果在操作事务完成数据处理之前，任何其他事务都不可以添加新数据，则可避免该问题</li>
<li>针对的是 <code>insert</code></li>
<li>要更新隐藏的行之后才能看到幻读现象</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@tx_isolation;</span><br><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL repeatable read;</span><br><span class="line">SET GLOBAL TRANSACTION ISOLATION LEVEL repeatable read;</span><br><span class="line">SELECT @@global.tx_isolation;</span><br><span class="line">SELECT @@session.tx_isolation;</span><br><span class="line">SELECT @@tx_isolation;</span><br><span class="line">start TRANSACTION;</span><br><span class="line">insert into account3(id,balance) values(<span class="number">5</span>,<span class="number">100</span>);</span><br><span class="line">commit;</span><br><span class="line">start TRANSACTION;</span><br><span class="line">select * <span class="keyword">from</span> account3;</span><br><span class="line">update account3 <span class="keyword">set</span> balance =balance-10;</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<h5 id="8-3-1-2-事务隔离五种级别"><a href="#8-3-1-2-事务隔离五种级别" class="headerlink" title="8.3.1.2 事务隔离五种级别"></a>8.3.1.2 事务隔离五种级别</h5><ul>
<li>read uncommitted : 读取尚未提交的数据 ：就是脏读</li>
<li>read committed：读取已经提交的数据 ：可以解决脏读</li>
<li>repeatable read：可重读读取：可以解决脏读和不可重复读 —mysql默认的</li>
<li>serializable：串行化：可以解决 脏读、不可重复读和幻读—相当于锁表</li>
<li>Innodb的默认事务隔离级别是重复读 <code>repeatable read</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@tx_isolation;</span><br><span class="line"><span class="keyword">set</span> session transaction isolation level</span><br><span class="line"><span class="keyword">set</span> session transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">隔离级别</th>
<th align="left">脏读</th>
<th align="left">非重复读</th>
<th align="left">幻读</th>
</tr>
</thead>
<tbody><tr>
<td align="left">read uncommitted</td>
<td align="left">允许</td>
<td align="left">允许</td>
<td align="left">允许</td>
</tr>
<tr>
<td align="left">read committed</td>
<td align="left"></td>
<td align="left">允许</td>
<td align="left">允许</td>
</tr>
<tr>
<td align="left">repeatable read</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">允许</td>
</tr>
<tr>
<td align="left">serializable</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h5 id="8-3-2-死锁"><a href="#8-3-2-死锁" class="headerlink" title="8.3.2 死锁"></a>8.3.2 死锁</h5><ul>
<li>只有在INNODB引擎上的索引键上才会启用行级锁</li>
<li>Deadlock found when trying to get lock; try restarting transaction</li>
</ul>
<table>
<thead>
<tr>
<th align="left">会话1</th>
<th align="left">会话2</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">set autocommit=0</td>
<td align="left">set autocommit=0</td>
<td align="left">都关闭默认提交</td>
</tr>
<tr>
<td align="left">update account set balance = balance -10 where name = ‘张三’</td>
<td align="left">update account2 set balance = balance -10 where name = ‘李四’</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">update account2 set balance = balance -10 where name = ‘李四’;</td>
<td align="left">update account2 set balance = balance -10 where name = ‘张三’;</td>
<td align="left"></td>
</tr>
</tbody></table>

          
            <div class='article_footer'>
              
                
  
    
    



  

  
    
    



  

  
    
    

<section class="widget copyright  desktop mobile">
  <div class='content'>
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href=http://yoursite.com/2021/05/10/mysql/>http://yoursite.com/2021/05/10/mysql/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  
    
    

<section class="widget qrcode  desktop mobile">
  

  <div class='content article-entry'>
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/qrcode/wiki_volantis.png'
        
          height='64px'
        ></div>
      
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/qrcode/wiki_volantis.png'
        
          height='64px'
        ></div>
      
    
  </div>
</section>

  


              
            </div>
          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2021-05-10T11:06:55+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：May 10, 2021</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/sql/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>sql</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2021/05/10/mysql/&title=mysql - Hexo&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2021/05/10/mysql/&title=mysql - Hexo&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2021/05/10/mysql/&title=mysql - Hexo&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class='prev' href='/2021/05/10/js-async/'>
                <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>js_async</p>
                <p class='content'>async从一个例子开始
1234567891011121314function loop0()&#123;  loop0()&#125;function loop1()&#123;  retu...</p>
              </a>
            
            
              <a class='next' href='/2021/05/08/davinci-dev/'>
                <p class='title'>davinci dev<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class='content'>
先安装maven

点击idea编辑器的Projects Structure 配置两个jar包；（在Libray中的java目录中）

打zip包至target


1mvn clean in...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box reveal comments shadow">
    <section class="article typo">
      <p ct><i class='fas fa-comments'></i> 评论</p>
      
      
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
          </div>
        </section>
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'mysql',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  

  
    
    


  <section class="widget toc-wrapper shadow desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-数据库能够做什么"><span class="toc-text">1. 数据库能够做什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-数据库的基本概念"><span class="toc-text">2. 数据库的基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-实体"><span class="toc-text">2.1 实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-数据库-DB"><span class="toc-text">2.2 数据库(DB)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-数据库管理系统-DBMS"><span class="toc-text">2.3 数据库管理系统(DBMS)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-SQL"><span class="toc-text">2.4 SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-SQL规范"><span class="toc-text">2.5 SQL规范</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-数据表"><span class="toc-text">3. 数据表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-MYSQL简介"><span class="toc-text">4.MYSQL简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-MYSQL特点"><span class="toc-text">4.1 MYSQL特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-MYSQL安装"><span class="toc-text">4.2 MYSQL安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-MYSQL配置"><span class="toc-text">4.3 MYSQL配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-MYSQL启动和停止"><span class="toc-text">4.4 MYSQL启动和停止</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-通过命令行连接MYSQL"><span class="toc-text">4.5 通过命令行连接MYSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-切换数据库"><span class="toc-text">4.6 切换数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-显示有哪些表"><span class="toc-text">4.7 显示有哪些表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-显示当前数据库"><span class="toc-text">4.8 显示当前数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-查询表结构"><span class="toc-text">4.9 查询表结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-创建表"><span class="toc-text">5. 创建表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-数据完整性"><span class="toc-text">6. 数据完整性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-域完整性"><span class="toc-text">6.1 域完整性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-默认值"><span class="toc-text">6.2 默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-非空约束"><span class="toc-text">6.3 非空约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-实体完整性"><span class="toc-text">7.实体完整性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-主键约束"><span class="toc-text">7.1 主键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-外键"><span class="toc-text">7.2 外键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-唯一约束"><span class="toc-text">7.3 唯一约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-标识列"><span class="toc-text">7.4 标识列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-外键约束"><span class="toc-text">7.5 外键约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-数据操作"><span class="toc-text">8. 数据操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-创建学生表"><span class="toc-text">8.1 创建学生表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-增加身份证号字段"><span class="toc-text">8.2 增加身份证号字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-添加约束"><span class="toc-text">8.3 添加约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-准备数据"><span class="toc-text">8.4 准备数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-SQL"><span class="toc-text">9. SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-SQL是什么"><span class="toc-text">9.1 SQL是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-为什么要用SQL"><span class="toc-text">9.2 为什么要用SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-SQL组成"><span class="toc-text">9.3 SQL组成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-1-DDL（data-definition-language）是数据定义语言"><span class="toc-text">9.3.1 DDL（data definition language）是数据定义语言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-DML（data-manipulation-language）是数据操纵语言"><span class="toc-text">9.3.2 DML（data manipulation language）是数据操纵语言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-3-DCL（DataControlLanguage）是数据库控制语言"><span class="toc-text">9.3.3 DCL（DataControlLanguage）是数据库控制语言</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-SQL运算符"><span class="toc-text">9.4 SQL运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-1-算术运算符"><span class="toc-text">9.4.1 算术运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-2-逻辑运算符"><span class="toc-text">9.4.2 逻辑运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-3-比较运算符"><span class="toc-text">9.4.3 比较运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-查询窗口"><span class="toc-text">9.5 查询窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-数据操作语言"><span class="toc-text">9.6 数据操作语言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-1-插入数据行"><span class="toc-text">9.6.1 插入数据行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-1-语法"><span class="toc-text">9.6.1.1 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-2-插入记录"><span class="toc-text">9.6.1.2 插入记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-3-注意事项"><span class="toc-text">9.6.1.3 注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-2-更新数据行"><span class="toc-text">9.6.2 更新数据行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-1-语法"><span class="toc-text">9.6.2.1 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-2-更新记录"><span class="toc-text">9.6.2.2 更新记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-3-注意"><span class="toc-text">9.6.2.3 注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-3-删除数据"><span class="toc-text">9.6.3 删除数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-1-语法"><span class="toc-text">9.6.3.1 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-2-删除记录"><span class="toc-text">9.6.3.2 删除记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-3-注意"><span class="toc-text">9.6.3.3 注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-4-TRUNCATE-截断表"><span class="toc-text">9.6.4 TRUNCATE 截断表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-4-1-语法"><span class="toc-text">9.6.4.1 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-4-2-截断学生表"><span class="toc-text">9.6.4.2 截断学生表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-7-数据查询"><span class="toc-text">9.7 数据查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-1-查询"><span class="toc-text">9.7.1 查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-1-语法"><span class="toc-text">9.7.1.1 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-2-排序"><span class="toc-text">9.7.1.2 排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-3-别名"><span class="toc-text">9.7.1.3 别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-4-查询空行"><span class="toc-text">9.7.1.4 查询空行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-5-常量列"><span class="toc-text">9.7.1.5 常量列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-6-限制返回的行数"><span class="toc-text">9.7.1.6 限制返回的行数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-7-DISTINCT"><span class="toc-text">9.7.1.7 DISTINCT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-8"><span class="toc-text">9.7.1.8 +</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-1-7-练习"><span class="toc-text">9.7.1.7 练习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-7-1-准备数据"><span class="toc-text">9.7.1.7.1 准备数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-7-2-查询山东省的同学全部信息"><span class="toc-text">9.7.1.7.2 查询山东省的同学全部信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-7-3-查询山东省的男同学的全部信息"><span class="toc-text">9.7.1.7.3 查询山东省的男同学的全部信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-7-4-查询没有填写电子邮箱的同学的姓名和身份证号"><span class="toc-text">9.7.1.7.4 查询没有填写电子邮箱的同学的姓名和身份证号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-1-8-排序"><span class="toc-text">9.7.1.8 排序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-8-1-把学生的分数按升序排列"><span class="toc-text">9.7.1.8.1 把学生的分数按升序排列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-8-2-把学生的分数按降序排列"><span class="toc-text">9.7.1.8.2 把学生的分数按降序排列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-8-3-课程编号按升序，成绩按降序"><span class="toc-text">9.7.1.8.3 课程编号按升序，成绩按降序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-8-函数"><span class="toc-text">9.8 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-1-字符函数"><span class="toc-text">9.8.1 字符函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-1-LENGTH"><span class="toc-text">9.8.1.1 LENGTH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-2-拼接字符串-CONCAT"><span class="toc-text">9.8.1.2 拼接字符串 [CONCAT]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-3-拼接字符串-UPPER"><span class="toc-text">9.8.1.3 拼接字符串 [UPPER]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-4-拼接字符串-LOWER"><span class="toc-text">9.8.1.4 拼接字符串 [LOWER]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-5-截取字符串-SUBSTR"><span class="toc-text">9.8.1.5 截取字符串 [SUBSTR]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-6-姓名的首字符大写，其它字符小写然后用-拼接"><span class="toc-text">9.8.1.6 姓名的首字符大写，其它字符小写然后用_拼接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-7-返回子串在原始字符串的起始索引"><span class="toc-text">9.8.1.7 返回子串在原始字符串的起始索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-8-去掉左右空格-TRIM"><span class="toc-text">9.8.1.8 去掉左右空格[TRIM]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-9-用空格补齐-LPAD"><span class="toc-text">9.8.1.9 用空格补齐[LPAD]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-10-替换"><span class="toc-text">9.8.1.10 替换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-11-FORMAT"><span class="toc-text">9.8.1.11 FORMAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-12-LEFT-RIGHT"><span class="toc-text">9.8.1.12 LEFT RIGHT</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-2-数学函数"><span class="toc-text">9.8.2 数学函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-2-1-四舍五入"><span class="toc-text">9.8.2.1 四舍五入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-2-2-向上取整"><span class="toc-text">9.8.2.2 向上取整</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-2-3-向下取整"><span class="toc-text">9.8.2.3 向下取整</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-2-4-截断"><span class="toc-text">9.8.2.4 截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-2-5-取余"><span class="toc-text">9.8.2.5 取余</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-3-日期函数"><span class="toc-text">9.8.3 日期函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-1-返回日期时间"><span class="toc-text">9.8.3.1 返回日期时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-2-返回日期"><span class="toc-text">9.8.3.2 返回日期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-3-返回日期"><span class="toc-text">9.8.3.3 返回日期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-4-返回日期中指定的部分"><span class="toc-text">9.8.3.4 返回日期中指定的部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-5-str-to-date"><span class="toc-text">9.8.3.5 str_to_date</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-6"><span class="toc-text">9.8.3.6</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-7-DATE-FORMAT"><span class="toc-text">9.8.3.7 DATE_FORMAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-8-DATE-ADD"><span class="toc-text">9.8.3.8 DATE_ADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-3-9-DATEDIFF"><span class="toc-text">9.8.3.9 DATEDIFF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-4-其它函数"><span class="toc-text">9.8.4 其它函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-5-流程控制函数"><span class="toc-text">9.8.5 流程控制函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-5-1-IF"><span class="toc-text">9.8.5.1 IF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-5-2-CASE函数"><span class="toc-text">9.8.5.2 CASE函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-9-自定义函数"><span class="toc-text">9.9 自定义函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-9-1-语法"><span class="toc-text">9.9.1 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-9-2-znow"><span class="toc-text">9.9.2 znow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-9-3-zadd"><span class="toc-text">9.9.3 zadd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-9-4-addUser"><span class="toc-text">9.9.4 addUser</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-10-模糊查询"><span class="toc-text">9.10 模糊查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-10-1-通配符"><span class="toc-text">9.10.1 通配符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-10-2-BETWEEN-AND"><span class="toc-text">9.10.2 BETWEEN AND</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-10-3-IN"><span class="toc-text">9.10.3 IN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-10-4-IS-NUL"><span class="toc-text">9.10.4 IS NUL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-DCL"><span class="toc-text">10. DCL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-创建用户"><span class="toc-text">10.1 创建用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-授予权限"><span class="toc-text">10.2 授予权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-授予权限"><span class="toc-text">10.3 授予权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-查看用户权限"><span class="toc-text">10.4 查看用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-删除用户"><span class="toc-text">10.5 删除用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-修改密码"><span class="toc-text">10.6 修改密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-存储过程"><span class="toc-text">11. 存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-语法"><span class="toc-text">11.1 语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-调用"><span class="toc-text">11.2 调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-删除"><span class="toc-text">11.3 删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-参数"><span class="toc-text">11.4 参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-索引"><span class="toc-text">12. 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-准备数据"><span class="toc-text">12.1 准备数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-创建普通索引"><span class="toc-text">12.2 创建普通索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-查看索引"><span class="toc-text">12.3 查看索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-4-删除索引"><span class="toc-text">12.4 删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-5-慢查询"><span class="toc-text">12.5 慢查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-6-索引创建的原则"><span class="toc-text">12.6 索引创建的原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-什么是聚合函数"><span class="toc-text">13. 什么是聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-SUM"><span class="toc-text">1.1 SUM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-AVG"><span class="toc-text">1.2 AVG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-MAX、MIN"><span class="toc-text">1.3 MAX、MIN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-AVG"><span class="toc-text">1.4 AVG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-COUNT"><span class="toc-text">1.5 COUNT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-分组"><span class="toc-text">14. 分组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-语法"><span class="toc-text">2.1 语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-练习"><span class="toc-text">2.2 练习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-分组筛选"><span class="toc-text">2.3 分组筛选</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-语法"><span class="toc-text">2.3.1 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-练习"><span class="toc-text">2.3.2 练习</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-子查询"><span class="toc-text">15. 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-比较运算符的子查询"><span class="toc-text">3.1 比较运算符的子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-查询年龄大于平均年龄的学生"><span class="toc-text">3.2 查询年龄大于平均年龄的学生</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-ANY-SOME-ALL"><span class="toc-text">3.2 ANY SOME ALL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-查询一下有考试成绩的学生信息"><span class="toc-text">3.3 查询一下有考试成绩的学生信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-表连接"><span class="toc-text">16. 表连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-连接类型"><span class="toc-text">4.1　连接类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-连接条件"><span class="toc-text">4.2　连接条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-内连接"><span class="toc-text">4.3　内连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-左外连接"><span class="toc-text">4.4　左外连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-右外连接"><span class="toc-text">4.5　右外连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-多表连接"><span class="toc-text">4.6　多表连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-无限分类-自身连接"><span class="toc-text">4.7　无限分类[自身连接]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-1-建表"><span class="toc-text">4.7.1 建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-2-插入语句"><span class="toc-text">4.7.2 插入语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-3-查询所有的顶级分类下面分类的数量"><span class="toc-text">4.7.3 查询所有的顶级分类下面分类的数量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-4-父类变成名称"><span class="toc-text">4.7.4 父类变成名称</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-删除重复记录-多表删除"><span class="toc-text">4.8 删除重复记录[多表删除]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-1-子查询找要删除的ID"><span class="toc-text">4.8.1 子查询找要删除的ID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-2-通过IN找要删除的ID"><span class="toc-text">4.8.2 通过IN找要删除的ID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-3-删除重复记录"><span class="toc-text">4.8.3 删除重复记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-多表更新"><span class="toc-text">4.9 多表更新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-9-1-插入省份-INSERT-SELECT"><span class="toc-text">4.9.1 (插入省份)INSERT SELECT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-9-2-更新省份"><span class="toc-text">4.9.2　更新省份</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-9-3-修改字段"><span class="toc-text">4.9.3 修改字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-为什么需要设计数据库"><span class="toc-text">17. 为什么需要设计数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-良好的数据库设计"><span class="toc-text">1.1 良好的数据库设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-糟糕的数据库设计"><span class="toc-text">1.2 糟糕的数据库设计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-软件项目开发周期中的数据库设计"><span class="toc-text">18. 软件项目开发周期中的数据库设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-设计数据库的步骤"><span class="toc-text">19.设计数据库的步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-收集信息"><span class="toc-text">3.1 收集信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-标示实体-Entity"><span class="toc-text">3.2 标示实体(Entity)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-标示实体的属性-Attribute"><span class="toc-text">3.3 标示实体的属性(Attribute)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-标示实体之间的关系-RelationShip"><span class="toc-text">3.4 标示实体之间的关系(RelationShip)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-数据库ER图"><span class="toc-text">20. 数据库ER图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-ER图的实体（entity）"><span class="toc-text">4.1 ER图的实体（entity）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-ER图的属性（attribute）"><span class="toc-text">4.2 ER图的属性（attribute）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-ER图的关系（relationship）"><span class="toc-text">4.3 ER图的关系（relationship）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-ER图中关联关系"><span class="toc-text">4.4 ER图中关联关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-1对1-1-1"><span class="toc-text">4.4.1 1对1 (1:1)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-1对多（1-N）"><span class="toc-text">4.4.2 1对多（1:N）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-3-多对多（M-N）"><span class="toc-text">4.4.3 多对多（M:N）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-数据库设计三大范式"><span class="toc-text">21. 数据库设计三大范式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-不合理的表设计"><span class="toc-text">5.1 不合理的表设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-三大范式"><span class="toc-text">5.2 三大范式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-第一范式（1NF）"><span class="toc-text">5.2.1 第一范式（1NF）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-第二范式（2NF）"><span class="toc-text">5.2.2 第二范式（2NF）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-第三范式（3NF）"><span class="toc-text">5.2.3 第三范式（3NF）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-4-如何更好的区分三大范式"><span class="toc-text">5.2.4 如何更好的区分三大范式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-RBAC"><span class="toc-text">22.RBAC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-安全原则"><span class="toc-text">5.1 安全原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-ER图"><span class="toc-text">5.2 ER图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-用户表"><span class="toc-text">5.2.1 用户表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-角色表"><span class="toc-text">5.2.2 角色表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-资源表"><span class="toc-text">5.2.3 资源表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-4-用户角色表"><span class="toc-text">5.2.4 用户角色表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-5-角色资源"><span class="toc-text">5.2.5 角色资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-数据库脚本"><span class="toc-text">5.3 数据库脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-事务"><span class="toc-text">23.事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-为什么需要事务"><span class="toc-text">6.1 为什么需要事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-什么是事务"><span class="toc-text">6.2 什么是事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-事务的特性"><span class="toc-text">6.3 事务的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-如何创建事务"><span class="toc-text">6.4 如何创建事务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-在node中使用mysql"><span class="toc-text">24.在node中使用mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-使用mysql"><span class="toc-text">7.1 使用mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-使用mysql连接池"><span class="toc-text">7.2 使用mysql连接池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-使用mysql事务"><span class="toc-text">7.3 使用mysql事务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-锁"><span class="toc-text">25.锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-锁的分类"><span class="toc-text">8.1 锁的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-表锁"><span class="toc-text">8.2 表锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-准备数据"><span class="toc-text">8.2.1 准备数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-加读锁"><span class="toc-text">8.2.2 加读锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-3-加写锁"><span class="toc-text">8.2.3 加写锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-行锁"><span class="toc-text">8.3 行锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-1-行锁支持事务"><span class="toc-text">8.3.1 行锁支持事务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-3-1-1-并发事务处理带来的问题"><span class="toc-text">8.3.1.1 并发事务处理带来的问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-3-1-2-事务隔离五种级别"><span class="toc-text">8.3.1.2 事务隔离五种级别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-3-2-死锁"><span class="toc-text">8.3.2 死锁</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </section>


  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.7'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='340px'
      server='netease'
      type='playlist'
      id='3175833810'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:me@xaoxuu.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/xaoxuu"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=63035382"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        Use
        <a href="https://volantis.js.org/" target="_blank" class="codename">belief</a>
        as theme, total visits
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          times
        
      
    
      
        <div class='copyright'>
        <p><a href="https://xaoxuu.com" target="_blank" rel="noopener">Copyright © 2017-2020 Mr. X</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>


  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '8px',
        duration: '800',
        interval: '100',
        scale: '1'
      });
    });
  </script>


  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script defer src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  









  
    
<script src="https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"></script>

  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var meta = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick','mail','link'];
  var requiredFields = 'nick,mail'.split(',').filter(function(item){
    return REQUIRED_FIELDS.indexOf(item) > -1
  });
  var valine = new Valine();
  function emoji(path, idx, ext) {
      return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  valine.init({
    el: '#valine_container',
    meta: meta,
    
    appId: "dogUA2FSKGTo029M1SEwGROT-MdYXbMMI",
    appKey: "u0NdtQ8nvHoMdJPSYqm1LRxE",
    placeholder: "快来评论吧~",
    pageSize:'10',
    avatar:'robohash',
    lang:'zh-cn',
    visitor: 'true',
    highlight: 'true',
    mathJax: 'false',
    enableQQ: 'true',
    requiredFields: requiredFields,
    emojiCDN: 'https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/emoji/valine/',
    emojiMaps: emojiMaps
  })
  </script>





  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.6.5/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>






<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-check-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-check-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-times-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-times-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  function pjax_fancybox() {
    $(".article-entry").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 标准 markdown 描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".article-entry").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  $(function () {
    pjax_fancybox();
  });
</script>




  <script>setLoadingBarProgress(100);</script>
</body>
</html>
